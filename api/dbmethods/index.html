
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../annotation/">
      
      
        <link rel="next" href="../loaders/">
      
      
      <link rel="icon" href="../../img/icons8_layers.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.6">
    
    
      
        <title>Dbmethods - VoDEx Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.35e1ed30.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#vodexdbmethods-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="VoDEx Docs" class="md-header__button md-logo" aria-label="VoDEx Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            VoDEx Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Dbmethods
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/LemonJust/vodex" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    LemonJust/vodex
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../install/" class="md-tabs__link">
        
  
    
  
  Installation

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../qstart/" class="md-tabs__link">
          
  
    
  
  Quick Start

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../examples/" class="md-tabs__link">
        
  
    
  
  Examples

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../db/" class="md-tabs__link">
        
  
    
  
  Database

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../contribute/" class="md-tabs__link">
        
  
    
  
  Contributions

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../data/" class="md-tabs__link">
        
  
    
  
  Data

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../napari/" class="md-tabs__link">
          
  
    
  
  napari_vodex

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="VoDEx Docs" class="md-nav__button md-logo" aria-label="VoDEx Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5Z"/></svg>

    </a>
    VoDEx Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/LemonJust/vodex" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    LemonJust/vodex
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../qstart/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Quick Start
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Quick Start
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qstart/new_experiment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create Experiment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qstart/load_experiment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Load Experiment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qstart/load_volumes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Load Volumes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    API
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../annotation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Annotation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Dbmethods
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Dbmethods
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.vodex.dbmethods" class="md-nav__link">
    dbmethods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbExporter" class="md-nav__link">
    DbExporter
  </a>
  
    <nav class="md-nav" aria-label="DbExporter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbExporter.load" class="md-nav__link">
    load()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbExporter.reconstruct_annotations" class="md-nav__link">
    reconstruct_annotations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbExporter.reconstruct_cycle" class="md-nav__link">
    reconstruct_cycle()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbExporter.reconstruct_file_manager" class="md-nav__link">
    reconstruct_file_manager()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbExporter.reconstruct_labels" class="md-nav__link">
    reconstruct_labels()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbExporter.reconstruct_volume_manager" class="md-nav__link">
    reconstruct_volume_manager()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader" class="md-nav__link">
    DbReader
  </a>
  
    <nav class="md-nav" aria-label="DbReader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.choose_frames_per_slices" class="md-nav__link">
    choose_frames_per_slices()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.choose_full_volumes" class="md-nav__link">
    choose_full_volumes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_AnnotationTypeLabelId_from_Annotations" class="md-nav__link">
    get_AnnotationTypeLabelId_from_Annotations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_Id_map_to_Names_from_AnnotationTypeLabels" class="md-nav__link">
    get_Id_map_to_Names_from_AnnotationTypeLabels()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_Name_and_Description_from_AnnotationTypeLabels" class="md-nav__link">
    get_Name_and_Description_from_AnnotationTypeLabels()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_Names_from_AnnotationTypes" class="md-nav__link">
    get_Names_from_AnnotationTypes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_Structure_from_Cycle" class="md-nav__link">
    get_Structure_from_Cycle()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_and_frames_per_annotations" class="md-nav__link">
    get_and_frames_per_annotations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_conditionIds_per_cycle_per_frame" class="md-nav__link">
    get_conditionIds_per_cycle_per_frame()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_conditionIds_per_cycle_per_volumes" class="md-nav__link">
    get_conditionIds_per_cycle_per_volumes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_cycleIterations_per_frame" class="md-nav__link">
    get_cycleIterations_per_frame()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_cycleIterations_per_volumes" class="md-nav__link">
    get_cycleIterations_per_volumes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_cycle_names" class="md-nav__link">
    get_cycle_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_data_dir" class="md-nav__link">
    get_data_dir()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_fgf" class="md-nav__link">
    get_fgf()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_file_names" class="md-nav__link">
    get_file_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_fpv" class="md-nav__link">
    get_fpv()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_frames_per_file" class="md-nav__link">
    get_frames_per_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_frames_per_volumes" class="md-nav__link">
    get_frames_per_volumes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_options" class="md-nav__link">
    get_options()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_or_frames_per_annotations" class="md-nav__link">
    get_or_frames_per_annotations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_volume_annotations" class="md-nav__link">
    get_volume_annotations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.get_volume_list" class="md-nav__link">
    get_volume_list()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.load" class="md-nav__link">
    load()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbReader.prepare_frames_for_loading" class="md-nav__link">
    prepare_frames_for_loading()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbWriter" class="md-nav__link">
    DbWriter
  </a>
  
    <nav class="md-nav" aria-label="DbWriter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbWriter.add_annotations" class="md-nav__link">
    add_annotations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbWriter.create" class="md-nav__link">
    create()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbWriter.delete_annotation" class="md-nav__link">
    delete_annotation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbWriter.load" class="md-nav__link">
    load()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbWriter.populate" class="md-nav__link">
    populate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.vodex.dbmethods.DbWriter.save" class="md-nav__link">
    save()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../loaders/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Loaders
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../experiment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiment
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../db/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributions
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../napari/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    napari_vodex
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            napari_vodex
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../napari/how-to/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="vodexdbmethods-module">vodex.dbmethods module</h1>


<div class="doc doc-object doc-module">



<a id="src.vodex.dbmethods"></a>
  <div class="doc doc-contents first">
  
      <p>This module contains classes that provide a consistent and easy-to-use interface for interacting
with the SQLite database.</p>
<p>DbWriter - A class that writes information to the database. It abstracts the SQLite calls and allows for easy
creation, population, and saving of the database.</p>
<p>DbReader - A class that reads information from the database. It abstracts the SQLite calls and allows for easy
querying and retrieval of data from the database.</p>
<p>DbExporter - A class that transforms the information from the database into the core classes, such as 'FileManager',
'VolumeManager', 'Labels', 'Timeline', 'Cycle' and 'Annotation', making it easier to view and edit with the data.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="src.vodex.dbmethods.DbExporter" class="doc doc-heading">
          <code>DbExporter</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Transforms the information from the database into the core classes.</p>

            <details class="quote">
              <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1458" name="__codelineno-0-1458"></a><span class="k">class</span> <span class="nc">DbExporter</span><span class="p">:</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a><span class="sd">    Transforms the information from the database into the core classes.</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>    <span class="c1"># TODO : make it work for annotations</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_reader</span><span class="p">:</span> <span class="n">DbReader</span><span class="p">):</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db_reader</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a><span class="sd">        Loads a database from a file and initialises a DbExporter.</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a><span class="sd">            file_name: full path to a file to database.</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>        <span class="n">db_reader</span> <span class="o">=</span> <span class="n">DbReader</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">db_reader</span><span class="p">)</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>    <span class="k">def</span> <span class="nf">reconstruct_file_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a><span class="sd">        Creates file manager from the database records.</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>        <span class="n">data_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_data_dir</span><span class="p">()</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>        <span class="n">file_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_file_names</span><span class="p">()</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>        <span class="n">frames_per_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_frames_per_file</span><span class="p">()</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>        <span class="n">fm</span> <span class="o">=</span> <span class="n">FileManager</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">file_names</span><span class="o">=</span><span class="n">file_names</span><span class="p">,</span> <span class="n">frames_per_file</span><span class="o">=</span><span class="n">frames_per_file</span><span class="p">)</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>        <span class="k">return</span> <span class="n">fm</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>    <span class="k">def</span> <span class="nf">reconstruct_volume_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a><span class="sd">        Creates volume manager from the database records.</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>        <span class="n">fm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_file_manager</span><span class="p">()</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>        <span class="n">fpv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_fpv</span><span class="p">()</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>        <span class="n">fgf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_fgf</span><span class="p">()</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>        <span class="n">vm</span> <span class="o">=</span> <span class="n">VolumeManager</span><span class="p">(</span><span class="n">fpv</span><span class="p">,</span> <span class="n">FrameManager</span><span class="p">(</span><span class="n">fm</span><span class="p">),</span> <span class="n">fgf</span><span class="o">=</span><span class="n">fgf</span><span class="p">)</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>        <span class="k">return</span> <span class="n">vm</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>    <span class="k">def</span> <span class="nf">reconstruct_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a><span class="sd">        Creates labels corresponding to the specified annotation from the database records.</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>        <span class="n">state_names</span><span class="p">,</span> <span class="n">state_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_Name_and_Description_from_AnnotationTypeLabels</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">Labels</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">state_names</span><span class="p">,</span> <span class="n">state_info</span><span class="o">=</span><span class="n">state_info</span><span class="p">)</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>        <span class="k">return</span> <span class="n">labels</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>    <span class="k">def</span> <span class="nf">reconstruct_timeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_labels</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>        <span class="kn">import</span> <span class="nn">itertools</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a><span class="sd">        Creates timeline corresponding to the specified annotation from the database records.</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>        <span class="c1"># get the mapping between the names and the Ids</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>        <span class="n">label_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_Id_map_to_Names_from_AnnotationTypeLabels</span><span class="p">()</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>        <span class="c1"># get all the labels that were used in the annotation ( does not reconstruct unused Labels )</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>        <span class="n">labels_per_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_AnnotationTypeLabelId_from_Annotations</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>        <span class="n">label_order</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>        <span class="n">duration</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>        <span class="k">for</span> <span class="n">label_id</span><span class="p">,</span> <span class="n">frames</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">labels_per_frame</span><span class="p">):</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>            <span class="n">label_name</span> <span class="o">=</span> <span class="n">label_names</span><span class="p">[</span><span class="n">label_id</span><span class="p">]</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>            <span class="n">label_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">label_name</span><span class="p">))</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>            <span class="n">duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">))</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>        <span class="n">timeline</span> <span class="o">=</span> <span class="n">Timeline</span><span class="p">(</span><span class="n">label_order</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>        <span class="k">return</span> <span class="n">timeline</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>    <span class="k">def</span> <span class="nf">reconstruct_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a><span class="sd">        Creates cycle corresponding to the specified annotation from the database records.</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>        <span class="n">cycle_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_Structure_from_Cycle</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>        <span class="k">if</span> <span class="n">cycle_json</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>            <span class="n">cycle</span> <span class="o">=</span> <span class="n">Cycle</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">cycle_json</span><span class="p">)</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>            <span class="n">cycle</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>        <span class="k">return</span> <span class="n">cycle</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>    <span class="k">def</span> <span class="nf">reconstruct_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a><span class="sd">        Creates annotations from the database records.</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>        <span class="c1"># get the names of all the available annotations from the db</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>        <span class="n">annotation_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_Names_from_AnnotationTypes</span><span class="p">()</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>        <span class="c1"># get the total number of frames in the recording</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>        <span class="n">n_frames</span> <span class="o">=</span> <span class="n">FrameManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_file_manager</span><span class="p">())</span><span class="o">.</span><span class="n">n_frames</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>        <span class="n">annotations</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">annotation_names</span><span class="p">:</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>            <span class="c1"># reconstruct Labels for the group</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_labels</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>            <span class="c1"># try to get a cycle</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>            <span class="n">cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_cycle</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>            <span class="c1"># define the annotation type ( Cycle / Timeline)</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>            <span class="k">if</span> <span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>                <span class="n">annotation</span> <span class="o">=</span> <span class="n">Annotation</span><span class="o">.</span><span class="n">from_cycle</span><span class="p">(</span><span class="n">n_frames</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">cycle</span><span class="p">)</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>                <span class="n">timeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_timeline</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>                <span class="n">annotation</span> <span class="o">=</span> <span class="n">Annotation</span><span class="o">.</span><span class="n">from_timeline</span><span class="p">(</span><span class="n">n_frames</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">timeline</span><span class="p">)</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>            <span class="n">annotations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>        <span class="k">return</span> <span class="n">annotations</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbExporter.load" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Loads a database from a file and initialises a DbExporter.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>file_name</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="src.vodex.core.Path">Path</span>, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>full path to a file to database.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1468" name="__codelineno-0-1468"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a><span class="sd">    Loads a database from a file and initialises a DbExporter.</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a><span class="sd">        file_name: full path to a file to database.</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>    <span class="n">db_reader</span> <span class="o">=</span> <span class="n">DbReader</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">db_reader</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbExporter.reconstruct_annotations" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">reconstruct_annotations</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates annotations from the database records.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1540" name="__codelineno-0-1540"></a><span class="k">def</span> <span class="nf">reconstruct_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a><span class="sd">    Creates annotations from the database records.</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>    <span class="c1"># get the names of all the available annotations from the db</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>    <span class="n">annotation_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_Names_from_AnnotationTypes</span><span class="p">()</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>    <span class="c1"># get the total number of frames in the recording</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>    <span class="n">n_frames</span> <span class="o">=</span> <span class="n">FrameManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_file_manager</span><span class="p">())</span><span class="o">.</span><span class="n">n_frames</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>    <span class="n">annotations</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">annotation_names</span><span class="p">:</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>        <span class="c1"># reconstruct Labels for the group</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_labels</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>        <span class="c1"># try to get a cycle</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>        <span class="n">cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_cycle</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>        <span class="c1"># define the annotation type ( Cycle / Timeline)</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>        <span class="k">if</span> <span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>            <span class="n">annotation</span> <span class="o">=</span> <span class="n">Annotation</span><span class="o">.</span><span class="n">from_cycle</span><span class="p">(</span><span class="n">n_frames</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">cycle</span><span class="p">)</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>            <span class="n">timeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_timeline</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>            <span class="n">annotation</span> <span class="o">=</span> <span class="n">Annotation</span><span class="o">.</span><span class="n">from_timeline</span><span class="p">(</span><span class="n">n_frames</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">timeline</span><span class="p">)</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>        <span class="n">annotations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>    <span class="k">return</span> <span class="n">annotations</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbExporter.reconstruct_cycle" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">reconstruct_cycle</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates cycle corresponding to the specified annotation from the database records.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1529" name="__codelineno-0-1529"></a><span class="k">def</span> <span class="nf">reconstruct_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a><span class="sd">    Creates cycle corresponding to the specified annotation from the database records.</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>    <span class="n">cycle_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_Structure_from_Cycle</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>    <span class="k">if</span> <span class="n">cycle_json</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>        <span class="n">cycle</span> <span class="o">=</span> <span class="n">Cycle</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">cycle_json</span><span class="p">)</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>        <span class="n">cycle</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>    <span class="k">return</span> <span class="n">cycle</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbExporter.reconstruct_file_manager" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">reconstruct_file_manager</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates file manager from the database records.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1479" name="__codelineno-0-1479"></a><span class="k">def</span> <span class="nf">reconstruct_file_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a><span class="sd">    Creates file manager from the database records.</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>    <span class="n">data_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_data_dir</span><span class="p">()</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>    <span class="n">file_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_file_names</span><span class="p">()</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>    <span class="n">frames_per_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_frames_per_file</span><span class="p">()</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>    <span class="n">fm</span> <span class="o">=</span> <span class="n">FileManager</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">file_names</span><span class="o">=</span><span class="n">file_names</span><span class="p">,</span> <span class="n">frames_per_file</span><span class="o">=</span><span class="n">frames_per_file</span><span class="p">)</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>    <span class="k">return</span> <span class="n">fm</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbExporter.reconstruct_labels" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">reconstruct_labels</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates labels corresponding to the specified annotation from the database records.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1500" name="__codelineno-0-1500"></a><span class="k">def</span> <span class="nf">reconstruct_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a><span class="sd">    Creates labels corresponding to the specified annotation from the database records.</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>    <span class="n">state_names</span><span class="p">,</span> <span class="n">state_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_Name_and_Description_from_AnnotationTypeLabels</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>    <span class="n">labels</span> <span class="o">=</span> <span class="n">Labels</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">state_names</span><span class="p">,</span> <span class="n">state_info</span><span class="o">=</span><span class="n">state_info</span><span class="p">)</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>    <span class="k">return</span> <span class="n">labels</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbExporter.reconstruct_volume_manager" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">reconstruct_volume_manager</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates volume manager from the database records.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1490" name="__codelineno-0-1490"></a><span class="k">def</span> <span class="nf">reconstruct_volume_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a><span class="sd">    Creates volume manager from the database records.</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>    <span class="n">fm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_file_manager</span><span class="p">()</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>    <span class="n">fpv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_fpv</span><span class="p">()</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>    <span class="n">fgf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_fgf</span><span class="p">()</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>    <span class="n">vm</span> <span class="o">=</span> <span class="n">VolumeManager</span><span class="p">(</span><span class="n">fpv</span><span class="p">,</span> <span class="n">FrameManager</span><span class="p">(</span><span class="n">fm</span><span class="p">),</span> <span class="n">fgf</span><span class="o">=</span><span class="n">fgf</span><span class="p">)</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>    <span class="k">return</span> <span class="n">vm</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.vodex.dbmethods.DbReader" class="doc doc-heading">
          <code>DbReader</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Reads information from the database.
Database interface that abstracts the SQLite calls.</p>

            <details class="quote">
              <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-482"> 482</a></span>
<span class="normal"><a href="#__codelineno-0-483"> 483</a></span>
<span class="normal"><a href="#__codelineno-0-484"> 484</a></span>
<span class="normal"><a href="#__codelineno-0-485"> 485</a></span>
<span class="normal"><a href="#__codelineno-0-486"> 486</a></span>
<span class="normal"><a href="#__codelineno-0-487"> 487</a></span>
<span class="normal"><a href="#__codelineno-0-488"> 488</a></span>
<span class="normal"><a href="#__codelineno-0-489"> 489</a></span>
<span class="normal"><a href="#__codelineno-0-490"> 490</a></span>
<span class="normal"><a href="#__codelineno-0-491"> 491</a></span>
<span class="normal"><a href="#__codelineno-0-492"> 492</a></span>
<span class="normal"><a href="#__codelineno-0-493"> 493</a></span>
<span class="normal"><a href="#__codelineno-0-494"> 494</a></span>
<span class="normal"><a href="#__codelineno-0-495"> 495</a></span>
<span class="normal"><a href="#__codelineno-0-496"> 496</a></span>
<span class="normal"><a href="#__codelineno-0-497"> 497</a></span>
<span class="normal"><a href="#__codelineno-0-498"> 498</a></span>
<span class="normal"><a href="#__codelineno-0-499"> 499</a></span>
<span class="normal"><a href="#__codelineno-0-500"> 500</a></span>
<span class="normal"><a href="#__codelineno-0-501"> 501</a></span>
<span class="normal"><a href="#__codelineno-0-502"> 502</a></span>
<span class="normal"><a href="#__codelineno-0-503"> 503</a></span>
<span class="normal"><a href="#__codelineno-0-504"> 504</a></span>
<span class="normal"><a href="#__codelineno-0-505"> 505</a></span>
<span class="normal"><a href="#__codelineno-0-506"> 506</a></span>
<span class="normal"><a href="#__codelineno-0-507"> 507</a></span>
<span class="normal"><a href="#__codelineno-0-508"> 508</a></span>
<span class="normal"><a href="#__codelineno-0-509"> 509</a></span>
<span class="normal"><a href="#__codelineno-0-510"> 510</a></span>
<span class="normal"><a href="#__codelineno-0-511"> 511</a></span>
<span class="normal"><a href="#__codelineno-0-512"> 512</a></span>
<span class="normal"><a href="#__codelineno-0-513"> 513</a></span>
<span class="normal"><a href="#__codelineno-0-514"> 514</a></span>
<span class="normal"><a href="#__codelineno-0-515"> 515</a></span>
<span class="normal"><a href="#__codelineno-0-516"> 516</a></span>
<span class="normal"><a href="#__codelineno-0-517"> 517</a></span>
<span class="normal"><a href="#__codelineno-0-518"> 518</a></span>
<span class="normal"><a href="#__codelineno-0-519"> 519</a></span>
<span class="normal"><a href="#__codelineno-0-520"> 520</a></span>
<span class="normal"><a href="#__codelineno-0-521"> 521</a></span>
<span class="normal"><a href="#__codelineno-0-522"> 522</a></span>
<span class="normal"><a href="#__codelineno-0-523"> 523</a></span>
<span class="normal"><a href="#__codelineno-0-524"> 524</a></span>
<span class="normal"><a href="#__codelineno-0-525"> 525</a></span>
<span class="normal"><a href="#__codelineno-0-526"> 526</a></span>
<span class="normal"><a href="#__codelineno-0-527"> 527</a></span>
<span class="normal"><a href="#__codelineno-0-528"> 528</a></span>
<span class="normal"><a href="#__codelineno-0-529"> 529</a></span>
<span class="normal"><a href="#__codelineno-0-530"> 530</a></span>
<span class="normal"><a href="#__codelineno-0-531"> 531</a></span>
<span class="normal"><a href="#__codelineno-0-532"> 532</a></span>
<span class="normal"><a href="#__codelineno-0-533"> 533</a></span>
<span class="normal"><a href="#__codelineno-0-534"> 534</a></span>
<span class="normal"><a href="#__codelineno-0-535"> 535</a></span>
<span class="normal"><a href="#__codelineno-0-536"> 536</a></span>
<span class="normal"><a href="#__codelineno-0-537"> 537</a></span>
<span class="normal"><a href="#__codelineno-0-538"> 538</a></span>
<span class="normal"><a href="#__codelineno-0-539"> 539</a></span>
<span class="normal"><a href="#__codelineno-0-540"> 540</a></span>
<span class="normal"><a href="#__codelineno-0-541"> 541</a></span>
<span class="normal"><a href="#__codelineno-0-542"> 542</a></span>
<span class="normal"><a href="#__codelineno-0-543"> 543</a></span>
<span class="normal"><a href="#__codelineno-0-544"> 544</a></span>
<span class="normal"><a href="#__codelineno-0-545"> 545</a></span>
<span class="normal"><a href="#__codelineno-0-546"> 546</a></span>
<span class="normal"><a href="#__codelineno-0-547"> 547</a></span>
<span class="normal"><a href="#__codelineno-0-548"> 548</a></span>
<span class="normal"><a href="#__codelineno-0-549"> 549</a></span>
<span class="normal"><a href="#__codelineno-0-550"> 550</a></span>
<span class="normal"><a href="#__codelineno-0-551"> 551</a></span>
<span class="normal"><a href="#__codelineno-0-552"> 552</a></span>
<span class="normal"><a href="#__codelineno-0-553"> 553</a></span>
<span class="normal"><a href="#__codelineno-0-554"> 554</a></span>
<span class="normal"><a href="#__codelineno-0-555"> 555</a></span>
<span class="normal"><a href="#__codelineno-0-556"> 556</a></span>
<span class="normal"><a href="#__codelineno-0-557"> 557</a></span>
<span class="normal"><a href="#__codelineno-0-558"> 558</a></span>
<span class="normal"><a href="#__codelineno-0-559"> 559</a></span>
<span class="normal"><a href="#__codelineno-0-560"> 560</a></span>
<span class="normal"><a href="#__codelineno-0-561"> 561</a></span>
<span class="normal"><a href="#__codelineno-0-562"> 562</a></span>
<span class="normal"><a href="#__codelineno-0-563"> 563</a></span>
<span class="normal"><a href="#__codelineno-0-564"> 564</a></span>
<span class="normal"><a href="#__codelineno-0-565"> 565</a></span>
<span class="normal"><a href="#__codelineno-0-566"> 566</a></span>
<span class="normal"><a href="#__codelineno-0-567"> 567</a></span>
<span class="normal"><a href="#__codelineno-0-568"> 568</a></span>
<span class="normal"><a href="#__codelineno-0-569"> 569</a></span>
<span class="normal"><a href="#__codelineno-0-570"> 570</a></span>
<span class="normal"><a href="#__codelineno-0-571"> 571</a></span>
<span class="normal"><a href="#__codelineno-0-572"> 572</a></span>
<span class="normal"><a href="#__codelineno-0-573"> 573</a></span>
<span class="normal"><a href="#__codelineno-0-574"> 574</a></span>
<span class="normal"><a href="#__codelineno-0-575"> 575</a></span>
<span class="normal"><a href="#__codelineno-0-576"> 576</a></span>
<span class="normal"><a href="#__codelineno-0-577"> 577</a></span>
<span class="normal"><a href="#__codelineno-0-578"> 578</a></span>
<span class="normal"><a href="#__codelineno-0-579"> 579</a></span>
<span class="normal"><a href="#__codelineno-0-580"> 580</a></span>
<span class="normal"><a href="#__codelineno-0-581"> 581</a></span>
<span class="normal"><a href="#__codelineno-0-582"> 582</a></span>
<span class="normal"><a href="#__codelineno-0-583"> 583</a></span>
<span class="normal"><a href="#__codelineno-0-584"> 584</a></span>
<span class="normal"><a href="#__codelineno-0-585"> 585</a></span>
<span class="normal"><a href="#__codelineno-0-586"> 586</a></span>
<span class="normal"><a href="#__codelineno-0-587"> 587</a></span>
<span class="normal"><a href="#__codelineno-0-588"> 588</a></span>
<span class="normal"><a href="#__codelineno-0-589"> 589</a></span>
<span class="normal"><a href="#__codelineno-0-590"> 590</a></span>
<span class="normal"><a href="#__codelineno-0-591"> 591</a></span>
<span class="normal"><a href="#__codelineno-0-592"> 592</a></span>
<span class="normal"><a href="#__codelineno-0-593"> 593</a></span>
<span class="normal"><a href="#__codelineno-0-594"> 594</a></span>
<span class="normal"><a href="#__codelineno-0-595"> 595</a></span>
<span class="normal"><a href="#__codelineno-0-596"> 596</a></span>
<span class="normal"><a href="#__codelineno-0-597"> 597</a></span>
<span class="normal"><a href="#__codelineno-0-598"> 598</a></span>
<span class="normal"><a href="#__codelineno-0-599"> 599</a></span>
<span class="normal"><a href="#__codelineno-0-600"> 600</a></span>
<span class="normal"><a href="#__codelineno-0-601"> 601</a></span>
<span class="normal"><a href="#__codelineno-0-602"> 602</a></span>
<span class="normal"><a href="#__codelineno-0-603"> 603</a></span>
<span class="normal"><a href="#__codelineno-0-604"> 604</a></span>
<span class="normal"><a href="#__codelineno-0-605"> 605</a></span>
<span class="normal"><a href="#__codelineno-0-606"> 606</a></span>
<span class="normal"><a href="#__codelineno-0-607"> 607</a></span>
<span class="normal"><a href="#__codelineno-0-608"> 608</a></span>
<span class="normal"><a href="#__codelineno-0-609"> 609</a></span>
<span class="normal"><a href="#__codelineno-0-610"> 610</a></span>
<span class="normal"><a href="#__codelineno-0-611"> 611</a></span>
<span class="normal"><a href="#__codelineno-0-612"> 612</a></span>
<span class="normal"><a href="#__codelineno-0-613"> 613</a></span>
<span class="normal"><a href="#__codelineno-0-614"> 614</a></span>
<span class="normal"><a href="#__codelineno-0-615"> 615</a></span>
<span class="normal"><a href="#__codelineno-0-616"> 616</a></span>
<span class="normal"><a href="#__codelineno-0-617"> 617</a></span>
<span class="normal"><a href="#__codelineno-0-618"> 618</a></span>
<span class="normal"><a href="#__codelineno-0-619"> 619</a></span>
<span class="normal"><a href="#__codelineno-0-620"> 620</a></span>
<span class="normal"><a href="#__codelineno-0-621"> 621</a></span>
<span class="normal"><a href="#__codelineno-0-622"> 622</a></span>
<span class="normal"><a href="#__codelineno-0-623"> 623</a></span>
<span class="normal"><a href="#__codelineno-0-624"> 624</a></span>
<span class="normal"><a href="#__codelineno-0-625"> 625</a></span>
<span class="normal"><a href="#__codelineno-0-626"> 626</a></span>
<span class="normal"><a href="#__codelineno-0-627"> 627</a></span>
<span class="normal"><a href="#__codelineno-0-628"> 628</a></span>
<span class="normal"><a href="#__codelineno-0-629"> 629</a></span>
<span class="normal"><a href="#__codelineno-0-630"> 630</a></span>
<span class="normal"><a href="#__codelineno-0-631"> 631</a></span>
<span class="normal"><a href="#__codelineno-0-632"> 632</a></span>
<span class="normal"><a href="#__codelineno-0-633"> 633</a></span>
<span class="normal"><a href="#__codelineno-0-634"> 634</a></span>
<span class="normal"><a href="#__codelineno-0-635"> 635</a></span>
<span class="normal"><a href="#__codelineno-0-636"> 636</a></span>
<span class="normal"><a href="#__codelineno-0-637"> 637</a></span>
<span class="normal"><a href="#__codelineno-0-638"> 638</a></span>
<span class="normal"><a href="#__codelineno-0-639"> 639</a></span>
<span class="normal"><a href="#__codelineno-0-640"> 640</a></span>
<span class="normal"><a href="#__codelineno-0-641"> 641</a></span>
<span class="normal"><a href="#__codelineno-0-642"> 642</a></span>
<span class="normal"><a href="#__codelineno-0-643"> 643</a></span>
<span class="normal"><a href="#__codelineno-0-644"> 644</a></span>
<span class="normal"><a href="#__codelineno-0-645"> 645</a></span>
<span class="normal"><a href="#__codelineno-0-646"> 646</a></span>
<span class="normal"><a href="#__codelineno-0-647"> 647</a></span>
<span class="normal"><a href="#__codelineno-0-648"> 648</a></span>
<span class="normal"><a href="#__codelineno-0-649"> 649</a></span>
<span class="normal"><a href="#__codelineno-0-650"> 650</a></span>
<span class="normal"><a href="#__codelineno-0-651"> 651</a></span>
<span class="normal"><a href="#__codelineno-0-652"> 652</a></span>
<span class="normal"><a href="#__codelineno-0-653"> 653</a></span>
<span class="normal"><a href="#__codelineno-0-654"> 654</a></span>
<span class="normal"><a href="#__codelineno-0-655"> 655</a></span>
<span class="normal"><a href="#__codelineno-0-656"> 656</a></span>
<span class="normal"><a href="#__codelineno-0-657"> 657</a></span>
<span class="normal"><a href="#__codelineno-0-658"> 658</a></span>
<span class="normal"><a href="#__codelineno-0-659"> 659</a></span>
<span class="normal"><a href="#__codelineno-0-660"> 660</a></span>
<span class="normal"><a href="#__codelineno-0-661"> 661</a></span>
<span class="normal"><a href="#__codelineno-0-662"> 662</a></span>
<span class="normal"><a href="#__codelineno-0-663"> 663</a></span>
<span class="normal"><a href="#__codelineno-0-664"> 664</a></span>
<span class="normal"><a href="#__codelineno-0-665"> 665</a></span>
<span class="normal"><a href="#__codelineno-0-666"> 666</a></span>
<span class="normal"><a href="#__codelineno-0-667"> 667</a></span>
<span class="normal"><a href="#__codelineno-0-668"> 668</a></span>
<span class="normal"><a href="#__codelineno-0-669"> 669</a></span>
<span class="normal"><a href="#__codelineno-0-670"> 670</a></span>
<span class="normal"><a href="#__codelineno-0-671"> 671</a></span>
<span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="k">class</span> <span class="nc">DbReader</span><span class="p">:</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">    Reads information from the database.</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">    Database interface that abstracts the SQLite calls.</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="c1"># TODO : get rid of list of tuples?</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>    <span class="c1">#  can do using `con.row_factory = sqlite3.Row`;</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>    <span class="c1">#  will get Row objects instead of tuples, and you can use row[0] like always or</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="c1">#  row[&#39;column_name&#39;] (case insensitive)</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>    <span class="c1">#  https://docs.python.org/2/library/sqlite3.html#sqlite3.Connection.row_factory</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>    <span class="c1">#  https://docs.python.org/2/library/sqlite3.html#accessing-columns-by-name-instead-of-by-index</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA foreign_keys = 1&quot;</span><span class="p">)</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="k">def</span> <span class="nf">get_n_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT COUNT(*) FROM Frames&quot;</span><span class="p">)</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>            <span class="n">n_frames</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get total number of frames from Frames because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>        <span class="k">return</span> <span class="n">n_frames</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>        <span class="c1"># get the volumes</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>    <span class="k">def</span> <span class="nf">get_data_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">        Get data directory</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="s2">                     WHERE Key = &quot;data_dir&quot; &quot;&quot;&quot;</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>            <span class="p">)</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>            <span class="n">data_dir</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_data_dir because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>        <span class="k">return</span> <span class="n">data_dir</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>    <span class="k">def</span> <span class="nf">get_fpv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">        Get frames per volume</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="s2">                     WHERE Key = &quot;frames_per_volume&quot; &quot;&quot;&quot;</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>            <span class="p">)</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>            <span class="n">fpv</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_fpv because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>        <span class="k">return</span> <span class="n">fpv</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>    <span class="k">def</span> <span class="nf">get_fgf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">        Get frames per volume</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="s2">                     WHERE Key = &quot;num_head_frames&quot; &quot;&quot;&quot;</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>            <span class="p">)</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>            <span class="n">fdf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_fgf because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>        <span class="k">return</span> <span class="n">fdf</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>    <span class="k">def</span> <span class="nf">get_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">        Gets the information from the OPTIONS table.</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">        Returns a dictionary with the Key: Value from the table.</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">        ( Keys: &#39;data_dir&#39;, &#39;frames_per_volume&#39;, &#39;num_head_frames&#39;, &#39;num_tail_frames&#39;, &#39;num_full_volumes&#39; )</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT * FROM Options&quot;&quot;&quot;</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>            <span class="p">)</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>            <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>                <span class="n">options</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_options because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="k">return</span> <span class="n">options</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>    <span class="k">def</span> <span class="nf">get_file_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">        Get the file names from the Files table.</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FileName FROM Files ORDER BY Id ASC&quot;&quot;&quot;</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>            <span class="p">)</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_file_names because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>        <span class="k">return</span> <span class="n">file_names</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>    <span class="k">def</span> <span class="nf">get_frames_per_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="sd">        Get the file names from the Files table.</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT NumFrames FROM Files ORDER BY Id ASC&quot;&quot;&quot;</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>            <span class="p">)</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>            <span class="n">frames_per_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_frames_per_file because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>        <span class="k">return</span> <span class="n">frames_per_file</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>    <span class="k">def</span> <span class="nf">get_volume_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a><span class="sd">        Returns a list of all the volumes.</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="sd">        :return: list of all the volumes</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="sd">        :rtype: [int]</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT DISTINCT VolumeId FROM Volumes&quot;</span><span class="p">)</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>            <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get total number of frames from Frames because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>        <span class="k">return</span> <span class="n">volume_ids</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">        Load the contents of a database file on disk to a</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a><span class="sd">        transient copy in memory without modifying the file</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>        <span class="n">disk_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>        <span class="n">memory_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>        <span class="n">disk_db</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>        <span class="n">disk_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>        <span class="c1"># Now use `memory_db` without modifying disk db</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>    <span class="k">def</span> <span class="nf">choose_full_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">):</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">        Chooses the frames from specified frames, that also correspond to full volumes.</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">        The order of the frames is not preserved!</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">        The result will correspond to frames sorted in increasing order !</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">        :param frames: a list of frame IDs</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">        :type frames: [int]</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">        :param fpv: frames per volume</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">        :type fpv: int</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">        :return: frames IDs from frames. corresponding to slices</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">        :rtype: [int]</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>        <span class="c1"># create list of frame Ids</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>        <span class="n">frame_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>        <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">)</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>        <span class="c1"># get the volumes</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>            <span class="c1"># get n_volumes (frames per volume)</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="s2">                    WHERE Key = &quot;frames_per_volume&quot; &quot;&quot;&quot;</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>            <span class="p">)</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>            <span class="n">fpv</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>            <span class="c1"># get ids of full volumes in the provided frames</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT VolumeId FROM</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="s2">                    (</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="s2">                    SELECT VolumeId, count(VolumeId) as N</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="s2">                    FROM Volumes</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="s2">                    WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="s2">                    GROUP BY VolumeId</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a><span class="s2">                    )</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="s2">                    WHERE N = ?&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="p">(</span><span class="n">fpv</span><span class="p">,)</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>            <span class="p">)</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>            <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>            <span class="n">n_volumes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">)</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>            <span class="c1"># get all frames from frames that correspond to full volumes</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Volumes</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a><span class="s2">                    WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a><span class="s2">                    AND VolumeId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_volumes</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">)</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>            <span class="p">)</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>            <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not choose_full_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>        <span class="k">return</span> <span class="n">volume_ids</span><span class="p">,</span> <span class="n">frame_ids</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>    <span class="k">def</span> <span class="nf">choose_frames_per_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">slices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="sd">        Chooses the frames from specified frames, that also correspond to the same slices (continuously)</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">        in different volumes.</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">        For example, if slices = [2,3,4] it will choose such frames from &quot;given frames&quot; that also correspond</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">        to a chunk from slice 2 to slice 4 in all the volumes.</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">        If there is a frame that corresponds to a slice &quot;2&quot; in a volume,</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a><span class="sd">        but no frames corresponding to the slices &quot;3&quot; and &quot;4&quot; in the SAME volume, such frame will not be picked.</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a><span class="sd">        The order of the frames is not preserved!</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">        The result will correspond to frames sorted in increasing order !</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">            frames: a list of frame IDs</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="sd">            slices: a list of slice IDs, order will not be preserved: will be sorted in increasing order</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">            frames IDs from frames. corresponding to slices</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>        <span class="c1"># create list of frame Ids</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>        <span class="n">frame_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>        <span class="n">slice_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>        <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">)</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>        <span class="n">n_slices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>        <span class="c1"># get the volumes</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Volumes</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="s2">                    WHERE FrameId in (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="s2">                    AND SliceInVolume IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_slices</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="s2">                    AND VolumeId IN</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="s2">                        (</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="s2">                        SELECT VolumeId FROM</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="s2">                            (</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="s2">                            SELECT VolumeId, count(VolumeId) as N </span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="s2">                            FROM Volumes </span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="s2">                            WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="s2">                            AND SliceInVolume IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_slices</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="s2">                            GROUP BY VolumeId</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="s2">                            )</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a><span class="s2">                        WHERE N = ?</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="s2">                        )&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="n">slice_ids</span> <span class="o">+</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="n">slice_ids</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_slices</span><span class="p">,)</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>            <span class="p">)</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>            <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not choose_frames_per_slices because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>        <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>        <span class="k">return</span> <span class="n">frame_ids</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>    <span class="k">def</span> <span class="nf">prepare_frames_for_loading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> \
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>            <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">        Finds all the information needed</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">        1) to load the frames</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">        2) and shape them back into volumes/slices.</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">        For each frame returns the image file,</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">        frame location on the image and corresponding volume.</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="sd">        The order is not preserved!</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">        the volume correspond to sorted volumes in increasing order !</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">            frames: a list of frame IDs</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="sd">             three lists, the length of the frames : data directory, file names,</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">             image files, frame location on the image, volumes.</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>        <span class="c1"># TODO : break into functions that get the file locations and the stuff relevant to the frames</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="c1"># TODO : make one &quot; prepare volumes &quot; for loading?</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>        <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>        <span class="c1"># get the frames</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>            <span class="c1"># get data directory</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a><span class="s2">                    FROM Options</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="s2">                    WHERE Key = &quot;data_dir&quot; &quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>            <span class="n">data_dir</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>            <span class="c1"># get file_names</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FileName</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="s2">                    FROM Files &quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>            <span class="n">file_names</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>            <span class="c1"># get info for every frame</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT </span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a><span class="s2">                        FileId,</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="s2">                        FrameInFile,</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a><span class="s2">                        VolumeId</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a><span class="s2">                    FROM </span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a><span class="s2">                        Frames</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a><span class="s2">                        INNER JOIN Volumes </span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a><span class="s2">                        ON Frames.Id = Volumes.FrameId</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="s2">                    WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">))</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>            <span class="n">frame_info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not prepare_frames_for_loading because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>        <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">]</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>        <span class="n">file_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">frame_info</span><span class="p">]</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>        <span class="n">frame_in_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">frame_info</span><span class="p">]</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>        <span class="n">volumes</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">frame_info</span><span class="p">]</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>        <span class="k">return</span> <span class="n">data_dir</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">file_ids</span><span class="p">,</span> <span class="n">frame_in_file</span><span class="p">,</span> <span class="n">volumes</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>    <span class="k">def</span> <span class="nf">get_frames_per_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">slices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a><span class="sd">        Finds all the frames that correspond to the specified volumes.</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a><span class="sd">        The order is not preserved!</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a><span class="sd">        the volume correspond to sorted volumes in increasing order !</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a><span class="sd">            volume_ids: a list of volume IDs</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a><span class="sd">            slices: a list of slice IDs, order will not be preserved: will be sorted in increasing order</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="sd">            a list of frame IDs that correspond to the specified volumes and</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">            slices (if specified).</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a><span class="sd">            order will not be preserved: frames will be sorted in increasing order</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>        <span class="n">ids</span> <span class="o">=</span> <span class="n">list_of_int</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">)</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>        <span class="k">if</span> <span class="n">slices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>            <span class="n">slices</span> <span class="o">=</span> <span class="n">list_of_int</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>            <span class="n">ids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>            <span class="c1"># get the frames</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>                <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Volumes </span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a><span class="s2">                                    WHERE VolumeId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">))</span><span class="si">}</span><span class="s2">) </span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a><span class="s2">                                    AND SliceInVolume IN  (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">slices</span><span class="p">))</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>                    <span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>                <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_frames_per_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>                <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>            <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>            <span class="c1"># get the frames</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>                <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Volumes </span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a><span class="s2">                        WHERE VolumeId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>                <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_frames_per_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>                <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>            <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>        <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>        <span class="c1"># sort the frames: this is important when having -2 and -1 as volume ids. Otherwise -2 will be first.</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>        <span class="n">frame_ids</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>        <span class="k">return</span> <span class="n">frame_ids</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>    <span class="k">def</span> <span class="nf">get_and_frames_per_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">):</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">        Chooses the frames that correspond to the specified conditions on annotation. Using &quot;and&quot; logic. Example : if</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">        you ask for frames corresponding to condition 1 and condition 2 , it will return such frames that both</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a><span class="sd">        condition 1 and condition 2 are True AT THE SAME TIME</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">        :param conditions: a list of conditions on the annotation labels</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">        in a form [(group, name),(group, name), ...] where group is a string for the annotation type</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">        and name is the name of the label of that annotation type. For example [(&#39;light&#39;, &#39;on&#39;), (&#39;shape&#39;,&#39;c&#39;)]</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="sd">        :type conditions: [tuple]</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a><span class="sd">        :return: list of frame Ids that satisfy all the conditions, if there are no such frames, an empty list</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a><span class="sd">        :rtype: list</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>        <span class="c1"># get the frames</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>            <span class="c1"># create list of label Ids</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>            <span class="n">labels_ids</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>            <span class="k">for</span> <span class="n">label_info</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>                <span class="n">labels_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_Id_from_AnnotationTypeLabels</span><span class="p">(</span><span class="n">label_info</span><span class="p">))</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>            <span class="n">labels_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>            <span class="n">n_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM </span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="s2">                    (SELECT FrameId, count(FrameId) as N </span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a><span class="s2">                    FROM Annotations </span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a><span class="s2">                    WHERE AnnotationTypeLabelId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_labels</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="s2">                    GROUP BY FrameId)</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a><span class="s2">                    WHERE N = </span><span class="si">{</span><span class="n">n_labels</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">labels_ids</span><span class="p">)</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>            <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_and_FrameId_from_Annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>        <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>        <span class="k">return</span> <span class="n">frame_ids</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>    <span class="k">def</span> <span class="nf">get_or_frames_per_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">):</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="sd">        Chooses the frames that correspond to the specified conditions on annotation. Using &quot;or&quot; logic. Example : if</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a><span class="sd">        you ask for frames corresponding to condition 1 and condition 2 , it will return such frames that either</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">        condition 1 is true OR condition 2 is True OR both are true.</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="sd">        :param conditions: a list of conditions on the annotation labels</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">        in a form [(group, name),(group, name), ...] where group is a string for the annotation type</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">        and name is the name of the label of that annotation type. For example [(&#39;light&#39;, &#39;on&#39;), (&#39;shape&#39;,&#39;c&#39;)]</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">        :type conditions: [tuple]</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">        :return:</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a><span class="sd">        :rtype:</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>        <span class="c1"># get the frames</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>            <span class="c1"># create list of label Ids</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>            <span class="n">labels_ids</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>            <span class="k">for</span> <span class="n">label_info</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>                <span class="n">labels_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_Id_from_AnnotationTypeLabels</span><span class="p">(</span><span class="n">label_info</span><span class="p">))</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>            <span class="n">labels_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>            <span class="n">n_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Annotations </span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="s2">                    WHERE AnnotationTypeLabelId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_labels</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="s2">                    GROUP BY FrameId&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">labels_ids</span><span class="p">)</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>            <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_or_FrameId_from_Annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>        <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>        <span class="k">return</span> <span class="n">frame_ids</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>    <span class="k">def</span> <span class="nf">get_volume_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volumes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>                               <span class="n">annotation_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a><span class="sd">        Returns a dictionary with annotations for the specified volumes. If annotation_name is specified, it will return only</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a><span class="sd">        the annotations for that annotation type. Otherwise, it will return all annotations for all annotation types.</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a><span class="sd">            volumes: list of volume ids</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a><span class="sd">            annotation_names: list of names of the annotation type to return annotations for. If None, it will return</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a><span class="sd">                annotations for all annotation types</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="sd">            dictionary with volumes ids and annotation labels for each volume and for each annotation type requested</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>        <span class="c1"># make sure volumes is a list of integers</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>        <span class="n">volume_ids</span> <span class="o">=</span> <span class="n">list_of_int</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>        <span class="c1"># get the annotations</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>            <span class="c1"># check that the annotation type exists</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Name FROM AnnotationTypes&quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>            <span class="n">annotations</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>            <span class="n">annotations</span> <span class="o">=</span> <span class="p">[</span><span class="n">annotation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">]</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>            <span class="k">if</span> <span class="n">annotation_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">annotation_names</span><span class="p">:</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                    <span class="k">assert</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Annotation type </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist&quot;</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>                <span class="n">annotations</span> <span class="o">=</span> <span class="n">annotation_names</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>            <span class="n">annotation_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>            <span class="k">for</span> <span class="n">annotation_name</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Volumes.VolumeId, AnnotationTypeLabels.Name FROM</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a><span class="s2">                        AnnotationTypeLabels </span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a><span class="s2">                        INNER JOIN Annotations ON AnnotationTypeLabels.Id = Annotations.AnnotationTypeLabelId </span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a><span class="s2">                        INNER JOIN Volumes ON Annotations.FrameId = Volumes.FrameId</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><span class="s2">                        INNER JOIN AnnotationTypes ON AnnotationTypes.Id = AnnotationTypeLabels.AnnotationTypeId</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><span class="s2">                        WHERE AnnotationTypes.Name = ?</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a><span class="s2">                        AND Volumes.VolumeId in (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">))</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="s2">                        ORDER BY Volumes.VolumeId&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>                    <span class="p">[</span><span class="n">annotation_name</span><span class="p">]</span> <span class="o">+</span> <span class="n">volume_ids</span><span class="p">)</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>                <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>                <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>                <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>                <span class="n">annotation_dict</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;volume_ids&#39;</span><span class="p">:</span> <span class="n">volume_ids</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="n">labels</span><span class="p">}</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_volume_annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>        <span class="k">return</span> <span class="n">annotation_dict</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>    <span class="k">def</span> <span class="nf">get_conditionIds_per_cycle_per_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a><span class="sd">        For the first cycle of a given annotation, returns a list of condition IDs that correspond to each volume:</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><span class="sd">        volume Index, condition that happens during that volume, how many frames that condition lasts in that volume.</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><span class="sd">        Warning: does not maintain the order of conditions within the volume!</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a><span class="sd">            annotation_name: str</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>            <span class="c1"># check that the annotation is a cycle</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Id FROM Cycles </span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><span class="s2">                WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,))</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;No Cycle for </span><span class="si">{</span><span class="n">annotation_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT VolumeId, AnnotationTypeLabelId, count(VolumeId) FROM</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="s2">                    CycleIterations </span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="s2">                    INNER JOIN Volumes ON CycleIterations.FrameId = Volumes.FrameId </span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="s2">                    INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="s2">                    WHERE AnnotationTypeLabelId in </span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="s2">                        (</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="s2">                        SELECT Id from AnnotationTypeLabels </span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><span class="s2">                        WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="s2">                        )</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><span class="s2">                    AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="s2">                    AND CycleIteration = 0</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="s2">                    GROUP BY VolumeId, AnnotationTypeLabelId</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="s2">                    ORDER BY VolumeId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>            <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>            <span class="n">condition_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>            <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_conditionIds_per_cycle_per_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>        <span class="k">return</span> <span class="n">volume_ids</span><span class="p">,</span> <span class="n">condition_ids</span><span class="p">,</span> <span class="n">count</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>    <span class="k">def</span> <span class="nf">get_conditionIds_per_cycle_per_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="sd">        Returns a list of condition IDs that correspond to each frame, list of corresponding frames.</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a><span class="sd">        annotation_name: str</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>        <span class="c1"># TODO : check if empty</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>            <span class="c1"># check that the annotation is a cycle</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Id FROM Cycles </span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="s2">                            WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>                <span class="p">(</span><span class="n">annotation_name</span><span class="p">,))</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;No Cycle for </span><span class="si">{</span><span class="n">annotation_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT CycleIterations.FrameId, AnnotationTypeLabelId FROM</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a><span class="s2">                    CycleIterations </span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a><span class="s2">                    INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a><span class="s2">                    WHERE AnnotationTypeLabelId in </span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a><span class="s2">                        (</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a><span class="s2">                        SELECT Id from AnnotationTypeLabels </span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a><span class="s2">                        WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a><span class="s2">                        )</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a><span class="s2">                    AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a><span class="s2">                    AND CycleIteration = 0</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a><span class="s2">                    ORDER BY CycleIterations.FrameId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>            <span class="c1"># TODO : check if empty</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>            <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>            <span class="n">condition_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_conditionIds_per_cycle_per_frame because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>        <span class="k">return</span> <span class="n">frame_ids</span><span class="p">,</span> <span class="n">condition_ids</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>    <span class="k">def</span> <span class="nf">get_cycleIterations_per_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="sd">        Returns a list of cycleIterations that correspond to each volume, list of corresponding volumes</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a><span class="sd">        and a count of the volume-iteration pairs</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a><span class="sd">        annotation_name: str</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>            <span class="c1"># check that the annotation is a cycle</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Id FROM Cycles </span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a><span class="s2">                                    WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>                <span class="p">(</span><span class="n">annotation_name</span><span class="p">,))</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;No Cycle for </span><span class="si">{</span><span class="n">annotation_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT VolumeId, CycleIteration, count(VolumeId) FROM</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="s2">                    CycleIterations </span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a><span class="s2">                    INNER JOIN Volumes ON CycleIterations.FrameId = Volumes.FrameId </span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a><span class="s2">                    INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a><span class="s2">                    WHERE AnnotationTypeLabelId in </span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a><span class="s2">                        (</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a><span class="s2">                        SELECT Id from AnnotationTypeLabels </span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a><span class="s2">                        WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a><span class="s2">                        )</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a><span class="s2">                    AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a><span class="s2">                    GROUP BY VolumeId</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a><span class="s2">                    ORDER BY VolumeId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>            <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>            <span class="n">cycle_its</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>            <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_cycleIterations_per_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>        <span class="k">return</span> <span class="n">volume_ids</span><span class="p">,</span> <span class="n">cycle_its</span><span class="p">,</span> <span class="n">count</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>    <span class="k">def</span> <span class="nf">get_cycleIterations_per_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a><span class="sd">        Returns a list of cycle iterations that correspond to each frame, list of corresponding frames.</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a><span class="sd">        annotation_name: str</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>            <span class="c1"># check that the annotation is a cycle</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Id FROM Cycles </span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a><span class="s2">                                                WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>                <span class="p">(</span><span class="n">annotation_name</span><span class="p">,))</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;No Cycle for </span><span class="si">{</span><span class="n">annotation_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT CycleIterations.FrameId, CycleIteration FROM</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a><span class="s2">                    CycleIterations </span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a><span class="s2">                    INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a><span class="s2">                    WHERE AnnotationTypeLabelId in </span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a><span class="s2">                        (</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a><span class="s2">                        SELECT Id from AnnotationTypeLabels </span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a><span class="s2">                        WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a><span class="s2">                        )</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a><span class="s2">                    AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a><span class="s2">                    ORDER BY CycleIterations.FrameId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>            <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>            <span class="n">cycle_its</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_conditionIds_per_cycle_per_frame because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>        <span class="k">return</span> <span class="n">frame_ids</span><span class="p">,</span> <span class="n">cycle_its</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>    <span class="k">def</span> <span class="nf">get_Names_from_AnnotationTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a><span class="sd">        Returns the names of all the available annotations.</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Name FROM AnnotationTypes ORDER BY Id&quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_Name_from_AnnotationTypes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>        <span class="k">return</span> <span class="n">names</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>    <span class="k">def</span> <span class="nf">get_cycle_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a><span class="sd">        Returns the names of all the available cycles.</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT AnnotationTypes.Name </span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a><span class="s2">                            FROM Cycles INNER JOIN AnnotationTypes </span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><span class="s2">                            ON Cycles.AnnotationTypeId = AnnotationTypes.Id&quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_cycle_names because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>        <span class="k">return</span> <span class="n">names</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>    <span class="k">def</span> <span class="nf">get_Structure_from_Cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a><span class="sd">        Returns cycle Structure if the annotation has a cycle entry or None otherwise.</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>        <span class="n">annotation_name</span> <span class="o">=</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,)</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Structure FROM Cycles WHERE AnnotationTypeId = </span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a><span class="s2">                             (SELECT Id FROM AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">)</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>            <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>                <span class="n">cycle</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>                <span class="n">cycle</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_Structure_from_Cycle because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>        <span class="k">return</span> <span class="n">cycle</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>    <span class="k">def</span> <span class="nf">get_Name_and_Description_from_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a><span class="sd">        Returns the Name and description for the labels that correspond to the annotation</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a><span class="sd">        with the provided group name.</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>        <span class="n">annotation_name</span> <span class="o">=</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,)</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>        <span class="n">descriptions</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Name, Description FROM AnnotationTypeLabels WHERE AnnotationTypeId = </span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a><span class="s2">                             (SELECT Id FROM AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">)</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>                <span class="n">descriptions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_Name_and_Description_from_AnnotationTypeLabels because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>        <span class="k">return</span> <span class="n">names</span><span class="p">,</span> <span class="n">descriptions</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>    <span class="k">def</span> <span class="nf">_get_Names_from_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Name FROM AnnotationTypeLabels ORDER BY Id ASC&quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_Name_from_AnnotationTypeLabels because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>        <span class="k">return</span> <span class="n">names</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>    <span class="k">def</span> <span class="nf">get_Id_map_to_Names_from_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a><span class="sd">        Returns a dictionary with Ids as keys and names as values.</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Id, Name FROM AnnotationTypeLabels ORDER BY Id ASC&quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>                <span class="n">mapping</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_Id_map_to_Names_from_AnnotationTypeLabels because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>        <span class="k">return</span> <span class="n">mapping</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a>    <span class="k">def</span> <span class="nf">_get_Id_from_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_info</span><span class="p">):</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a><span class="sd">        Returns the AnnotationTypeLabels.Id for a label , searching by its name and group name.</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a><span class="sd">        :param label_info: (annotation_name, label_name), where group is the AnnotationType.Name</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a><span class="sd">                            and name is AnnotationTypeLabels.Name</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a><span class="sd">        :type label_info: tuple</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a><span class="sd">        :return: AnnotationLabels.Id</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a><span class="sd">        :rtype: int</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Id FROM AnnotationTypeLabels </span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a><span class="s2">                    WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a><span class="s2">                    and Name = ?&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">label_info</span><span class="p">)</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>            <span class="n">label_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>            <span class="k">assert</span> <span class="n">label_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Could not find a label from group </span><span class="si">{</span><span class="n">label_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span> \
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>                                         <span class="sa">f</span><span class="s2">&quot;with name </span><span class="si">{</span><span class="n">label_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">. &quot;</span> \
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>                                         <span class="sa">f</span><span class="s2">&quot;Are you sure it&#39;s been added into the database? &quot;</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_AnnotationLabelId because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>        <span class="k">return</span> <span class="n">label_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>    <span class="k">def</span> <span class="nf">_get_Ids_from_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a><span class="sd">        Returns the AnnotationTypeLabels.Id for all labels , searching by their group name.</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a><span class="sd">        annotation_name: AnnotationType.Name</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a><span class="sd">            list of AnnotationLabels.Id</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>        <span class="n">annotation_name</span> <span class="o">=</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,)</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Id FROM AnnotationTypeLabels </span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a><span class="s2">                    WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">)</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>            <span class="n">label_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">label_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Could not find labels from group </span><span class="si">{</span><span class="n">annotation_name</span><span class="si">}</span><span class="s2"> &quot;</span> \
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>                                       <span class="s2">&quot;Are you sure it&#39;s been added into the database?&quot;</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_AnnotationLabelIds because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>        <span class="k">return</span> <span class="n">label_ids</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>    <span class="k">def</span> <span class="nf">get_AnnotationTypeLabelId_from_Annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a><span class="sd">        Returns the AnnotationTypeLabelIds for all labels in the order according to the FrameId,</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a><span class="sd">         searching by their group name.</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a><span class="sd">        :param annotation_name: AnnotationType.Name</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a><span class="sd">        :type annotation_name: str</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a><span class="sd">        :return: AnnotationLabels.Id</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a><span class="sd">        :rtype: [int]</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>        <span class="n">annotation_name</span> <span class="o">=</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,)</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot; SELECT AnnotationTypeLabelId FROM Annotations WHERE AnnotationTypeLabelId IN</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a><span class="s2">                            (SELECT Id FROM AnnotationTypeLabels </span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a><span class="s2">                            WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?))</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a><span class="s2">                            ORDER BY FrameId ASC&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">)</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>            <span class="n">label_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">label_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Could not find labels from group </span><span class="si">{</span><span class="n">annotation_name</span><span class="si">}</span><span class="s2"> &quot;</span> \
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>                                       <span class="s2">&quot;Are you sure it&#39;s been added into the database?&quot;</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_AnnotationTypeLabelId_from_Annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>        <span class="k">return</span> <span class="n">label_ids</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>    <span class="k">def</span> <span class="nf">_get_SliceInVolume_from_Volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a><span class="sd">        Chooses the slices that correspond to the specified frames.</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a><span class="sd">        Warning!: The order of the frames is not preserved!</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a><span class="sd">        the volume correspond to frames sorted in increasing order !</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a><span class="sd">        Frames are numbered from 1, slices are numbered from 0.</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a><span class="sd">            frames: a list of frame IDs</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a><span class="sd">            volume IDs</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>        <span class="c1"># create list of frame Ids</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>        <span class="n">frame_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>        <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">)</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>        <span class="c1"># get the volumes</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT SliceInVolume FROM Volumes </span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a><span class="s2">                    WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span><span class="p">)</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>            <span class="n">slice_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">slice_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">),</span> \
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>                <span class="sa">f</span><span class="s2">&quot;Only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">slice_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> frames are in the database&quot;</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_SliceInVolume_from_Volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>        <span class="n">slice_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">slice_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">slice_id</span> <span class="ow">in</span> <span class="n">slice_ids</span><span class="p">]</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>        <span class="k">return</span> <span class="n">slice_ids</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>    <span class="k">def</span> <span class="nf">_get_VolumeId_from_Volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">):</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a><span class="sd">        Chooses the volumes that correspond to the specified frames.</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a><span class="sd">        Warning: The order is not preserved!</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a><span class="sd">        the volume correspond to sorted frames in increasing order !</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a><span class="sd">        :param frames: a list of frame IDs</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a><span class="sd">        :type frames: [int]</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a><span class="sd">        :return: volume IDs</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a><span class="sd">        :rtype: [int]</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>        <span class="c1"># create list of frame Ids</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>        <span class="n">frame_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>        <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">)</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>        <span class="c1"># get the volumes</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT VolumeId FROM Volumes </span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a><span class="s2">                    WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span><span class="p">)</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>            <span class="n">volume_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_VolumeId_from_Volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>        <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">volume_ids</span><span class="p">]</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>        <span class="k">return</span> <span class="n">volume_ids</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.choose_frames_per_slices" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">choose_frames_per_slices</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">slices</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Chooses the frames from specified frames, that also correspond to the same slices (continuously)
in different volumes.
For example, if slices = [2,3,4] it will choose such frames from "given frames" that also correspond
to a chunk from slice 2 to slice 4 in all the volumes.
If there is a frame that corresponds to a slice "2" in a volume,
but no frames corresponding to the slices "3" and "4" in the SAME volume, such frame will not be picked.</p>
<p>The order of the frames is not preserved!
The result will correspond to frames sorted in increasing order !</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>frames</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a list of frame IDs</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>slices</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a list of slice IDs, order will not be preserved: will be sorted in increasing order</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>frames IDs from frames. corresponding to slices</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="k">def</span> <span class="nf">choose_frames_per_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">slices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="sd">    Chooses the frames from specified frames, that also correspond to the same slices (continuously)</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">    in different volumes.</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">    For example, if slices = [2,3,4] it will choose such frames from &quot;given frames&quot; that also correspond</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">    to a chunk from slice 2 to slice 4 in all the volumes.</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">    If there is a frame that corresponds to a slice &quot;2&quot; in a volume,</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a><span class="sd">    but no frames corresponding to the slices &quot;3&quot; and &quot;4&quot; in the SAME volume, such frame will not be picked.</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a><span class="sd">    The order of the frames is not preserved!</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">    The result will correspond to frames sorted in increasing order !</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">        frames: a list of frame IDs</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="sd">        slices: a list of slice IDs, order will not be preserved: will be sorted in increasing order</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">        frames IDs from frames. corresponding to slices</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>    <span class="c1"># create list of frame Ids</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>    <span class="n">frame_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>    <span class="n">slice_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>    <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">)</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>    <span class="n">n_slices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>    <span class="c1"># get the volumes</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Volumes</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="s2">                WHERE FrameId in (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="s2">                AND SliceInVolume IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_slices</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="s2">                AND VolumeId IN</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="s2">                    (</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="s2">                    SELECT VolumeId FROM</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="s2">                        (</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="s2">                        SELECT VolumeId, count(VolumeId) as N </span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="s2">                        FROM Volumes </span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="s2">                        WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="s2">                        AND SliceInVolume IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_slices</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="s2">                        GROUP BY VolumeId</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="s2">                        )</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a><span class="s2">                    WHERE N = ?</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="s2">                    )&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="n">slice_ids</span> <span class="o">+</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="n">slice_ids</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_slices</span><span class="p">,)</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>        <span class="p">)</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>        <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not choose_frames_per_slices because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>    <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>    <span class="k">return</span> <span class="n">frame_ids</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.choose_full_volumes" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">choose_full_volumes</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Chooses the frames from specified frames, that also correspond to full volumes.</p>
<p>The order of the frames is not preserved!
The result will correspond to frames sorted in increasing order !</p>
<p>:param frames: a list of frame IDs
:type frames: [int]
:param fpv: frames per volume
:type fpv: int
:return: frames IDs from frames. corresponding to slices
:rtype: [int]</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="k">def</span> <span class="nf">choose_full_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">):</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">    Chooses the frames from specified frames, that also correspond to full volumes.</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">    The order of the frames is not preserved!</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">    The result will correspond to frames sorted in increasing order !</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">    :param frames: a list of frame IDs</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">    :type frames: [int]</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">    :param fpv: frames per volume</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">    :type fpv: int</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">    :return: frames IDs from frames. corresponding to slices</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">    :rtype: [int]</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>    <span class="c1"># create list of frame Ids</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>    <span class="n">frame_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>    <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">)</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>    <span class="c1"># get the volumes</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>        <span class="c1"># get n_volumes (frames per volume)</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="s2">                WHERE Key = &quot;frames_per_volume&quot; &quot;&quot;&quot;</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>        <span class="p">)</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>        <span class="n">fpv</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>        <span class="c1"># get ids of full volumes in the provided frames</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT VolumeId FROM</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="s2">                (</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="s2">                SELECT VolumeId, count(VolumeId) as N</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="s2">                FROM Volumes</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="s2">                WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="s2">                GROUP BY VolumeId</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a><span class="s2">                )</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="s2">                WHERE N = ?&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="p">(</span><span class="n">fpv</span><span class="p">,)</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>        <span class="p">)</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>        <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>        <span class="n">n_volumes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">)</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>        <span class="c1"># get all frames from frames that correspond to full volumes</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Volumes</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a><span class="s2">                WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a><span class="s2">                AND VolumeId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_volumes</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">)</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>        <span class="p">)</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>        <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not choose_full_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>    <span class="k">return</span> <span class="n">volume_ids</span><span class="p">,</span> <span class="n">frame_ids</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_AnnotationTypeLabelId_from_Annotations" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_AnnotationTypeLabelId_from_Annotations</span><span class="p">(</span><span class="n">annotation_name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns the AnnotationTypeLabelIds for all labels in the order according to the FrameId,
 searching by their group name.
:param annotation_name: AnnotationType.Name
:type annotation_name: str
:return: AnnotationLabels.Id
:rtype: [int]</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1363" name="__codelineno-0-1363"></a><span class="k">def</span> <span class="nf">get_AnnotationTypeLabelId_from_Annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a><span class="sd">    Returns the AnnotationTypeLabelIds for all labels in the order according to the FrameId,</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a><span class="sd">     searching by their group name.</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a><span class="sd">    :param annotation_name: AnnotationType.Name</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a><span class="sd">    :type annotation_name: str</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a><span class="sd">    :return: AnnotationLabels.Id</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a><span class="sd">    :rtype: [int]</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>    <span class="n">annotation_name</span> <span class="o">=</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,)</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>        <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot; SELECT AnnotationTypeLabelId FROM Annotations WHERE AnnotationTypeLabelId IN</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a><span class="s2">                        (SELECT Id FROM AnnotationTypeLabels </span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a><span class="s2">                        WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?))</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a><span class="s2">                        ORDER BY FrameId ASC&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">)</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>        <span class="n">label_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">label_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Could not find labels from group </span><span class="si">{</span><span class="n">annotation_name</span><span class="si">}</span><span class="s2"> &quot;</span> \
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>                                   <span class="s2">&quot;Are you sure it&#39;s been added into the database?&quot;</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_AnnotationTypeLabelId_from_Annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>    <span class="k">return</span> <span class="n">label_ids</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_Id_map_to_Names_from_AnnotationTypeLabels" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_Id_map_to_Names_from_AnnotationTypeLabels</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a dictionary with Ids as keys and names as values.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1291" name="__codelineno-0-1291"></a><span class="k">def</span> <span class="nf">get_Id_map_to_Names_from_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a><span class="sd">    Returns a dictionary with Ids as keys and names as values.</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>        <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Id, Name FROM AnnotationTypeLabels ORDER BY Id ASC&quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>            <span class="n">mapping</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_Id_map_to_Names_from_AnnotationTypeLabels because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>    <span class="k">return</span> <span class="n">mapping</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_Name_and_Description_from_AnnotationTypeLabels" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_Name_and_Description_from_AnnotationTypeLabels</span><span class="p">(</span><span class="n">annotation_name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns the Name and description for the labels that correspond to the annotation
with the provided group name.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1252" name="__codelineno-0-1252"></a><span class="k">def</span> <span class="nf">get_Name_and_Description_from_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a><span class="sd">    Returns the Name and description for the labels that correspond to the annotation</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a><span class="sd">    with the provided group name.</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>    <span class="n">annotation_name</span> <span class="o">=</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,)</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>    <span class="n">descriptions</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>        <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Name, Description FROM AnnotationTypeLabels WHERE AnnotationTypeId = </span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a><span class="s2">                         (SELECT Id FROM AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">)</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>            <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>            <span class="n">descriptions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_Name_and_Description_from_AnnotationTypeLabels because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>    <span class="k">return</span> <span class="n">names</span><span class="p">,</span> <span class="n">descriptions</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_Names_from_AnnotationTypes" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_Names_from_AnnotationTypes</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns the names of all the available annotations.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1196" name="__codelineno-0-1196"></a><span class="k">def</span> <span class="nf">get_Names_from_AnnotationTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a><span class="sd">    Returns the names of all the available annotations.</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>        <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Name FROM AnnotationTypes ORDER BY Id&quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_Name_from_AnnotationTypes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>    <span class="k">return</span> <span class="n">names</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_Structure_from_Cycle" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_Structure_from_Cycle</span><span class="p">(</span><span class="n">annotation_name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns cycle Structure if the annotation has a cycle entry or None otherwise.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1230" name="__codelineno-0-1230"></a><span class="k">def</span> <span class="nf">get_Structure_from_Cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a><span class="sd">    Returns cycle Structure if the annotation has a cycle entry or None otherwise.</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>    <span class="n">annotation_name</span> <span class="o">=</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,)</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>        <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Structure FROM Cycles WHERE AnnotationTypeId = </span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a><span class="s2">                         (SELECT Id FROM AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">)</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>        <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>            <span class="n">cycle</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>            <span class="n">cycle</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_Structure_from_Cycle because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>    <span class="k">return</span> <span class="n">cycle</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_and_frames_per_annotations" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_and_frames_per_annotations</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Chooses the frames that correspond to the specified conditions on annotation. Using "and" logic. Example : if
you ask for frames corresponding to condition 1 and condition 2 , it will return such frames that both
condition 1 and condition 2 are True AT THE SAME TIME</p>
<p>:param conditions: a list of conditions on the annotation labels
in a form [(group, name),(group, name), ...] where group is a string for the annotation type
and name is the name of the label of that annotation type. For example [('light', 'on'), ('shape','c')]
:type conditions: [tuple]
:return: list of frame Ids that satisfy all the conditions, if there are no such frames, an empty list
:rtype: list</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-895" name="__codelineno-0-895"></a><span class="k">def</span> <span class="nf">get_and_frames_per_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">):</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">    Chooses the frames that correspond to the specified conditions on annotation. Using &quot;and&quot; logic. Example : if</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">    you ask for frames corresponding to condition 1 and condition 2 , it will return such frames that both</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a><span class="sd">    condition 1 and condition 2 are True AT THE SAME TIME</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">    :param conditions: a list of conditions on the annotation labels</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">    in a form [(group, name),(group, name), ...] where group is a string for the annotation type</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">    and name is the name of the label of that annotation type. For example [(&#39;light&#39;, &#39;on&#39;), (&#39;shape&#39;,&#39;c&#39;)]</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="sd">    :type conditions: [tuple]</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a><span class="sd">    :return: list of frame Ids that satisfy all the conditions, if there are no such frames, an empty list</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a><span class="sd">    :rtype: list</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>    <span class="c1"># get the frames</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>        <span class="c1"># create list of label Ids</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>        <span class="n">labels_ids</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>        <span class="k">for</span> <span class="n">label_info</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>            <span class="n">labels_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_Id_from_AnnotationTypeLabels</span><span class="p">(</span><span class="n">label_info</span><span class="p">))</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>        <span class="n">labels_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>        <span class="n">n_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>        <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM </span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="s2">                (SELECT FrameId, count(FrameId) as N </span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a><span class="s2">                FROM Annotations </span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a><span class="s2">                WHERE AnnotationTypeLabelId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_labels</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="s2">                GROUP BY FrameId)</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a><span class="s2">                WHERE N = </span><span class="si">{</span><span class="n">n_labels</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">labels_ids</span><span class="p">)</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>        <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_and_FrameId_from_Annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>    <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>    <span class="k">return</span> <span class="n">frame_ids</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_conditionIds_per_cycle_per_frame" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_conditionIds_per_cycle_per_frame</span><span class="p">(</span><span class="n">annotation_name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a list of condition IDs that correspond to each frame, list of corresponding frames.
annotation_name: str</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1075" name="__codelineno-0-1075"></a><span class="k">def</span> <span class="nf">get_conditionIds_per_cycle_per_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="sd">    Returns a list of condition IDs that correspond to each frame, list of corresponding frames.</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a><span class="sd">    annotation_name: str</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>    <span class="c1"># TODO : check if empty</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>        <span class="c1"># check that the annotation is a cycle</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Id FROM Cycles </span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="s2">                        WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>            <span class="p">(</span><span class="n">annotation_name</span><span class="p">,))</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;No Cycle for </span><span class="si">{</span><span class="n">annotation_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>        <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT CycleIterations.FrameId, AnnotationTypeLabelId FROM</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a><span class="s2">                CycleIterations </span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a><span class="s2">                INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a><span class="s2">                WHERE AnnotationTypeLabelId in </span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a><span class="s2">                    (</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a><span class="s2">                    SELECT Id from AnnotationTypeLabels </span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a><span class="s2">                    WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a><span class="s2">                    )</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a><span class="s2">                AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a><span class="s2">                AND CycleIteration = 0</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a><span class="s2">                ORDER BY CycleIterations.FrameId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>        <span class="c1"># TODO : check if empty</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>        <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>        <span class="n">condition_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_conditionIds_per_cycle_per_frame because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>    <span class="k">return</span> <span class="n">frame_ids</span><span class="p">,</span> <span class="n">condition_ids</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_conditionIds_per_cycle_per_volumes" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_conditionIds_per_cycle_per_volumes</span><span class="p">(</span><span class="n">annotation_name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>For the first cycle of a given annotation, returns a list of condition IDs that correspond to each volume:
volume Index, condition that happens during that volume, how many frames that condition lasts in that volume.
Warning: does not maintain the order of conditions within the volume!</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>annotation_name</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>str</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1030" name="__codelineno-0-1030"></a><span class="k">def</span> <span class="nf">get_conditionIds_per_cycle_per_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a><span class="sd">    For the first cycle of a given annotation, returns a list of condition IDs that correspond to each volume:</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><span class="sd">    volume Index, condition that happens during that volume, how many frames that condition lasts in that volume.</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><span class="sd">    Warning: does not maintain the order of conditions within the volume!</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a><span class="sd">        annotation_name: str</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>        <span class="c1"># check that the annotation is a cycle</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Id FROM Cycles </span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><span class="s2">            WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,))</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;No Cycle for </span><span class="si">{</span><span class="n">annotation_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>        <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT VolumeId, AnnotationTypeLabelId, count(VolumeId) FROM</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="s2">                CycleIterations </span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="s2">                INNER JOIN Volumes ON CycleIterations.FrameId = Volumes.FrameId </span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="s2">                INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="s2">                WHERE AnnotationTypeLabelId in </span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="s2">                    (</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="s2">                    SELECT Id from AnnotationTypeLabels </span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><span class="s2">                    WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="s2">                    )</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><span class="s2">                AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="s2">                AND CycleIteration = 0</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="s2">                GROUP BY VolumeId, AnnotationTypeLabelId</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="s2">                ORDER BY VolumeId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>        <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>        <span class="n">condition_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>        <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_conditionIds_per_cycle_per_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>    <span class="k">return</span> <span class="n">volume_ids</span><span class="p">,</span> <span class="n">condition_ids</span><span class="p">,</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_cycleIterations_per_frame" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_cycleIterations_per_frame</span><span class="p">(</span><span class="n">annotation_name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a list of cycle iterations that correspond to each frame, list of corresponding frames.
annotation_name: str</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1158" name="__codelineno-0-1158"></a><span class="k">def</span> <span class="nf">get_cycleIterations_per_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a><span class="sd">    Returns a list of cycle iterations that correspond to each frame, list of corresponding frames.</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a><span class="sd">    annotation_name: str</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>        <span class="c1"># check that the annotation is a cycle</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Id FROM Cycles </span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a><span class="s2">                                            WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>            <span class="p">(</span><span class="n">annotation_name</span><span class="p">,))</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;No Cycle for </span><span class="si">{</span><span class="n">annotation_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>        <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT CycleIterations.FrameId, CycleIteration FROM</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a><span class="s2">                CycleIterations </span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a><span class="s2">                INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a><span class="s2">                WHERE AnnotationTypeLabelId in </span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a><span class="s2">                    (</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a><span class="s2">                    SELECT Id from AnnotationTypeLabels </span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a><span class="s2">                    WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a><span class="s2">                    )</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a><span class="s2">                AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a><span class="s2">                ORDER BY CycleIterations.FrameId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>        <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>        <span class="n">cycle_its</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_conditionIds_per_cycle_per_frame because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>    <span class="k">return</span> <span class="n">frame_ids</span><span class="p">,</span> <span class="n">cycle_its</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_cycleIterations_per_volumes" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_cycleIterations_per_volumes</span><span class="p">(</span><span class="n">annotation_name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a list of cycleIterations that correspond to each volume, list of corresponding volumes
and a count of the volume-iteration pairs
annotation_name: str</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1116" name="__codelineno-0-1116"></a><span class="k">def</span> <span class="nf">get_cycleIterations_per_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="sd">    Returns a list of cycleIterations that correspond to each volume, list of corresponding volumes</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a><span class="sd">    and a count of the volume-iteration pairs</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a><span class="sd">    annotation_name: str</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>        <span class="c1"># check that the annotation is a cycle</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Id FROM Cycles </span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a><span class="s2">                                WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>            <span class="p">(</span><span class="n">annotation_name</span><span class="p">,))</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;No Cycle for </span><span class="si">{</span><span class="n">annotation_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>        <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT VolumeId, CycleIteration, count(VolumeId) FROM</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="s2">                CycleIterations </span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a><span class="s2">                INNER JOIN Volumes ON CycleIterations.FrameId = Volumes.FrameId </span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a><span class="s2">                INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a><span class="s2">                WHERE AnnotationTypeLabelId in </span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a><span class="s2">                    (</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a><span class="s2">                    SELECT Id from AnnotationTypeLabels </span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a><span class="s2">                    WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a><span class="s2">                    )</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a><span class="s2">                AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a><span class="s2">                GROUP BY VolumeId</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a><span class="s2">                ORDER BY VolumeId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>        <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>        <span class="n">cycle_its</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>        <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_cycleIterations_per_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>    <span class="k">return</span> <span class="n">volume_ids</span><span class="p">,</span> <span class="n">cycle_its</span><span class="p">,</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_cycle_names" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_cycle_names</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns the names of all the available cycles.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1212" name="__codelineno-0-1212"></a><span class="k">def</span> <span class="nf">get_cycle_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a><span class="sd">    Returns the names of all the available cycles.</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>        <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT AnnotationTypes.Name </span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a><span class="s2">                        FROM Cycles INNER JOIN AnnotationTypes </span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><span class="s2">                        ON Cycles.AnnotationTypeId = AnnotationTypes.Id&quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_cycle_names because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>    <span class="k">return</span> <span class="n">names</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_data_dir" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_data_dir</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get data directory</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="k">def</span> <span class="nf">get_data_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">    Get data directory</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="s2">                 WHERE Key = &quot;data_dir&quot; &quot;&quot;&quot;</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>        <span class="p">)</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="n">data_dir</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_data_dir because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>    <span class="k">return</span> <span class="n">data_dir</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_fgf" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_fgf</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get frames per volume</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="k">def</span> <span class="nf">get_fgf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">    Get frames per volume</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="s2">                 WHERE Key = &quot;num_head_frames&quot; &quot;&quot;&quot;</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="p">)</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="n">fdf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_fgf because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>    <span class="k">return</span> <span class="n">fdf</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_file_names" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_file_names</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get the file names from the Files table.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="k">def</span> <span class="nf">get_file_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">    Get the file names from the Files table.</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FileName FROM Files ORDER BY Id ASC&quot;&quot;&quot;</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="p">)</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>        <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_file_names because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>    <span class="k">return</span> <span class="n">file_names</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_fpv" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_fpv</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get frames per volume</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="k">def</span> <span class="nf">get_fpv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    Get frames per volume</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="s2">                 WHERE Key = &quot;frames_per_volume&quot; &quot;&quot;&quot;</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="p">)</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="n">fpv</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_fpv because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>    <span class="k">return</span> <span class="n">fpv</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_frames_per_file" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_frames_per_file</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get the file names from the Files table.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="k">def</span> <span class="nf">get_frames_per_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="sd">    Get the file names from the Files table.</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT NumFrames FROM Files ORDER BY Id ASC&quot;&quot;&quot;</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>        <span class="p">)</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>        <span class="n">frames_per_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_frames_per_file because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>    <span class="k">return</span> <span class="n">frames_per_file</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_frames_per_volumes" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_frames_per_volumes</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">,</span> <span class="n">slices</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Finds all the frames that correspond to the specified volumes.
The order is not preserved!
the volume correspond to sorted volumes in increasing order !</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>volume_ids</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a list of volume IDs</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>slices</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a list of slice IDs, order will not be preserved: will be sorted in increasing order</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a list of frame IDs that correspond to the specified volumes and</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>slices (if specified).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>order will not be preserved: frames will be sorted in increasing order</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-839" name="__codelineno-0-839"></a><span class="k">def</span> <span class="nf">get_frames_per_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">slices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a><span class="sd">    Finds all the frames that correspond to the specified volumes.</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a><span class="sd">    The order is not preserved!</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a><span class="sd">    the volume correspond to sorted volumes in increasing order !</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a><span class="sd">        volume_ids: a list of volume IDs</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a><span class="sd">        slices: a list of slice IDs, order will not be preserved: will be sorted in increasing order</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="sd">        a list of frame IDs that correspond to the specified volumes and</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">        slices (if specified).</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a><span class="sd">        order will not be preserved: frames will be sorted in increasing order</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>    <span class="n">ids</span> <span class="o">=</span> <span class="n">list_of_int</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">)</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>    <span class="k">if</span> <span class="n">slices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>        <span class="n">slices</span> <span class="o">=</span> <span class="n">list_of_int</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>        <span class="n">ids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>        <span class="c1"># get the frames</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Volumes </span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a><span class="s2">                                WHERE VolumeId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">))</span><span class="si">}</span><span class="s2">) </span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a><span class="s2">                                AND SliceInVolume IN  (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">slices</span><span class="p">))</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>                <span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>            <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_frames_per_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>        <span class="c1"># get the frames</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>            <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Volumes </span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a><span class="s2">                    WHERE VolumeId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>            <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_frames_per_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>    <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>    <span class="c1"># sort the frames: this is important when having -2 and -1 as volume ids. Otherwise -2 will be first.</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>    <span class="n">frame_ids</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>    <span class="k">return</span> <span class="n">frame_ids</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_options" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_options</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Gets the information from the OPTIONS table.
Returns a dictionary with the Key: Value from the table.
( Keys: 'data_dir', 'frames_per_volume', 'num_head_frames', 'num_tail_frames', 'num_full_volumes' )</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="k">def</span> <span class="nf">get_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">    Gets the information from the OPTIONS table.</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">    Returns a dictionary with the Key: Value from the table.</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">    ( Keys: &#39;data_dir&#39;, &#39;frames_per_volume&#39;, &#39;num_head_frames&#39;, &#39;num_tail_frames&#39;, &#39;num_full_volumes&#39; )</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT * FROM Options&quot;&quot;&quot;</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span class="p">)</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>            <span class="n">options</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_options because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>    <span class="k">return</span> <span class="n">options</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_or_frames_per_annotations" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_or_frames_per_annotations</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Chooses the frames that correspond to the specified conditions on annotation. Using "or" logic. Example : if
you ask for frames corresponding to condition 1 and condition 2 , it will return such frames that either
condition 1 is true OR condition 2 is True OR both are true.</p>
<p>:param conditions: a list of conditions on the annotation labels
in a form [(group, name),(group, name), ...] where group is a string for the annotation type
and name is the name of the label of that annotation type. For example [('light', 'on'), ('shape','c')]
:type conditions: [tuple]
:return:
:rtype:</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span>
<span class="normal"><a href="#__codelineno-0-970">970</a></span>
<span class="normal"><a href="#__codelineno-0-971">971</a></span>
<span class="normal"><a href="#__codelineno-0-972">972</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="k">def</span> <span class="nf">get_or_frames_per_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">):</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="sd">    Chooses the frames that correspond to the specified conditions on annotation. Using &quot;or&quot; logic. Example : if</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a><span class="sd">    you ask for frames corresponding to condition 1 and condition 2 , it will return such frames that either</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">    condition 1 is true OR condition 2 is True OR both are true.</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="sd">    :param conditions: a list of conditions on the annotation labels</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">    in a form [(group, name),(group, name), ...] where group is a string for the annotation type</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">    and name is the name of the label of that annotation type. For example [(&#39;light&#39;, &#39;on&#39;), (&#39;shape&#39;,&#39;c&#39;)]</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">    :type conditions: [tuple]</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">    :return:</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a><span class="sd">    :rtype:</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>    <span class="c1"># get the frames</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>        <span class="c1"># create list of label Ids</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>        <span class="n">labels_ids</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>        <span class="k">for</span> <span class="n">label_info</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>            <span class="n">labels_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_Id_from_AnnotationTypeLabels</span><span class="p">(</span><span class="n">label_info</span><span class="p">))</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>        <span class="n">labels_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>        <span class="n">n_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>        <span class="c1"># create a parameterised query with variable number of parameters</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Annotations </span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="s2">                WHERE AnnotationTypeLabelId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_labels</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="s2">                GROUP BY FrameId&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">labels_ids</span><span class="p">)</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>        <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_or_FrameId_from_Annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>    <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>    <span class="k">return</span> <span class="n">frame_ids</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_volume_annotations" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_volume_annotations</span><span class="p">(</span><span class="n">volumes</span><span class="p">,</span> <span class="n">annotation_names</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a dictionary with annotations for the specified volumes. If annotation_name is specified, it will return only
the annotations for that annotation type. Otherwise, it will return all annotations for all annotation types.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>volumes</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of volume ids</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>annotation_names</code></td>
          <td>
                <code><span title="src.vodex.annotation.Optional">Optional</span>[<span title="typing.List">List</span>[str]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of names of the annotation type to return annotations for. If None, it will return
annotations for all annotation types</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="src.vodex.annotation.Dict">Dict</span>[str, <span title="src.vodex.annotation.Dict">Dict</span>[str, <span title="typing.List">List</span>[str]]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dictionary with volumes ids and annotation labels for each volume and for each annotation type requested</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="k">def</span> <span class="nf">get_volume_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volumes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>                           <span class="n">annotation_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a><span class="sd">    Returns a dictionary with annotations for the specified volumes. If annotation_name is specified, it will return only</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a><span class="sd">    the annotations for that annotation type. Otherwise, it will return all annotations for all annotation types.</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a><span class="sd">        volumes: list of volume ids</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a><span class="sd">        annotation_names: list of names of the annotation type to return annotations for. If None, it will return</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a><span class="sd">            annotations for all annotation types</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="sd">        dictionary with volumes ids and annotation labels for each volume and for each annotation type requested</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>    <span class="c1"># make sure volumes is a list of integers</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>    <span class="n">volume_ids</span> <span class="o">=</span> <span class="n">list_of_int</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>    <span class="c1"># get the annotations</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>        <span class="c1"># check that the annotation type exists</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Name FROM AnnotationTypes&quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>        <span class="n">annotations</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>        <span class="n">annotations</span> <span class="o">=</span> <span class="p">[</span><span class="n">annotation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">]</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>        <span class="k">if</span> <span class="n">annotation_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">annotation_names</span><span class="p">:</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                <span class="k">assert</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Annotation type </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist&quot;</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>            <span class="n">annotations</span> <span class="o">=</span> <span class="n">annotation_names</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>        <span class="n">annotation_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>        <span class="k">for</span> <span class="n">annotation_name</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Volumes.VolumeId, AnnotationTypeLabels.Name FROM</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a><span class="s2">                    AnnotationTypeLabels </span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a><span class="s2">                    INNER JOIN Annotations ON AnnotationTypeLabels.Id = Annotations.AnnotationTypeLabelId </span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a><span class="s2">                    INNER JOIN Volumes ON Annotations.FrameId = Volumes.FrameId</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><span class="s2">                    INNER JOIN AnnotationTypes ON AnnotationTypes.Id = AnnotationTypeLabels.AnnotationTypeId</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><span class="s2">                    WHERE AnnotationTypes.Name = ?</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a><span class="s2">                    AND Volumes.VolumeId in (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">))</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="s2">                    ORDER BY Volumes.VolumeId&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>                <span class="p">[</span><span class="n">annotation_name</span><span class="p">]</span> <span class="o">+</span> <span class="n">volume_ids</span><span class="p">)</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>            <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>            <span class="n">annotation_dict</span><span class="p">[</span><span class="n">annotation_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;volume_ids&#39;</span><span class="p">:</span> <span class="n">volume_ids</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="n">labels</span><span class="p">}</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_volume_annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>    <span class="k">return</span> <span class="n">annotation_dict</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.get_volume_list" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_volume_list</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a list of all the volumes.
:return: list of all the volumes
:rtype: [int]</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="k">def</span> <span class="nf">get_volume_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a><span class="sd">    Returns a list of all the volumes.</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="sd">    :return: list of all the volumes</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="sd">    :rtype: [int]</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT DISTINCT VolumeId FROM Volumes&quot;</span><span class="p">)</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>        <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get total number of frames from Frames because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>    <span class="k">return</span> <span class="n">volume_ids</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.load" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Load the contents of a database file on disk to a
transient copy in memory without modifying the file</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">    Load the contents of a database file on disk to a</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a><span class="sd">    transient copy in memory without modifying the file</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>    <span class="n">disk_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>    <span class="n">memory_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>    <span class="n">disk_db</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>    <span class="n">disk_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>    <span class="c1"># Now use `memory_db` without modifying disk db</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbReader.prepare_frames_for_loading" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">prepare_frames_for_loading</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Finds all the information needed
1) to load the frames
2) and shape them back into volumes/slices.
For each frame returns the image file,
frame location on the image and corresponding volume.</p>
<p>The order is not preserved!
the volume correspond to sorted volumes in increasing order !</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>frames</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a list of frame IDs</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>three lists, the length of the frames : data directory, file names,</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>image files, frame location on the image, volumes.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="k">def</span> <span class="nf">prepare_frames_for_loading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> \
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>        <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">    Finds all the information needed</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">    1) to load the frames</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">    2) and shape them back into volumes/slices.</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">    For each frame returns the image file,</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">    frame location on the image and corresponding volume.</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="sd">    The order is not preserved!</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">    the volume correspond to sorted volumes in increasing order !</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">        frames: a list of frame IDs</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="sd">         three lists, the length of the frames : data directory, file names,</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">         image files, frame location on the image, volumes.</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>    <span class="c1"># TODO : break into functions that get the file locations and the stuff relevant to the frames</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>    <span class="c1"># TODO : make one &quot; prepare volumes &quot; for loading?</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>    <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>    <span class="c1"># get the frames</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>        <span class="c1"># get data directory</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a><span class="s2">                FROM Options</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="s2">                WHERE Key = &quot;data_dir&quot; &quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>        <span class="n">data_dir</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>        <span class="c1"># get file_names</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FileName</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="s2">                FROM Files &quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>        <span class="n">file_names</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>        <span class="c1"># get info for every frame</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT </span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a><span class="s2">                    FileId,</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="s2">                    FrameInFile,</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a><span class="s2">                    VolumeId</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a><span class="s2">                FROM </span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a><span class="s2">                    Frames</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a><span class="s2">                    INNER JOIN Volumes </span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a><span class="s2">                    ON Frames.Id = Volumes.FrameId</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="s2">                WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">))</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>        <span class="n">frame_info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not prepare_frames_for_loading because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>    <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">]</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>    <span class="n">file_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">frame_info</span><span class="p">]</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>    <span class="n">frame_in_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">frame_info</span><span class="p">]</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>    <span class="n">volumes</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">frame_info</span><span class="p">]</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>    <span class="k">return</span> <span class="n">data_dir</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">file_ids</span><span class="p">,</span> <span class="n">frame_in_file</span><span class="p">,</span> <span class="n">volumes</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.vodex.dbmethods.DbWriter" class="doc doc-heading">
          <code>DbWriter</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Writes information to the database.
Database interface that abstracts the SQLite calls.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>connection</code></td>
          <td>
                <code><span title="sqlite3.Connection">Connection</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>connection to the SQL database</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="k">class</span> <span class="nc">DbWriter</span><span class="p">:</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    Writes information to the database.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Database interface that abstracts the SQLite calls.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        connection: connection to the SQL database</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">:</span> <span class="n">Connection</span><span class="p">):</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA foreign_keys = 1&quot;</span><span class="p">)</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        Backup a database to a file.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        Will CLOSE connection to the database in memory!</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">            file_name : the name of the file to save database to, EX.: &#39;databasename.db&#39;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="k">def</span> <span class="nf">progress</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">remaining</span><span class="p">,</span> <span class="n">total</span><span class="p">):</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Copied </span><span class="si">{</span><span class="n">total</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">remaining</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s1"> pages...&#39;</span><span class="p">)</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="n">backup_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="k">with</span> <span class="n">backup_db</span><span class="p">:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">backup_db</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="c1"># self.connection.close()</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="n">backup_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        Creates an empty DB for the experiment in memory.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="c1"># For an in-memory only database:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">memory_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        Load the contents of a database file on disk to a</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        transient copy in memory without modifying the file.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">disk_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="n">memory_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">disk_db</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="n">disk_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="c1"># Now use `memory_db` without modifying disk db</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volumes</span><span class="p">:</span> <span class="n">VolumeManager</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">annotations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Annotation</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        Creates the tables if they don&#39;t exist and fills with the provided data.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">            volumes: mapping of frames to volumes, and to slices in volumes, frames per volume</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">            annotations: mapping of frames to labels, list of annotations</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="c1"># will only create if they don&#39;t exist</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_create_tables</span><span class="p">()</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="c1"># TODO : write cases for files and frames not None</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">if</span> <span class="n">volumes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Options</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">file_manager</span><span class="p">,</span> <span class="n">volumes</span><span class="p">)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Files</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">file_manager</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Frames</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">frame_manager</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Volumes</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">if</span> <span class="n">annotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_annotations</span><span class="p">(</span><span class="n">annotations</span><span class="p">)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="k">def</span> <span class="nf">add_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Annotation</span><span class="p">]):</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        Adds a list of annotations to the database.</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        Does NOT save the database after adding.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        To keep this change in the future, you need to save the database after adding.</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">            annotations: mapping of frames to labels, list of annotations</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="c1"># TODO : add list checking</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_AnnotationTypes</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_AnnotationTypeLabels</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Annotations</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="k">if</span> <span class="n">annotation</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Cycles</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_populate_CycleIterations</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="k">def</span> <span class="nf">delete_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        Deletes annotation from all the tables.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        Deletion by &quot;ON DELETE CASCADE&quot; from AnnotationTypes, AnnotationTypeLabels, Annotations,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        Cycles, CycleIterations.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="c1"># get the volumes</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT * FROM AnnotationTypes WHERE Name = ?&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;No annotation </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in the database.&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;DELETE FROM AnnotationTypes </span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="s2">                            WHERE Name = ?&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not delete_annotation because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">def</span> <span class="nf">_get_n_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        Queries and returns the total number of frames in the experiment.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        Used when creating Annotations and Cycles.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT COUNT(*) FROM Frames&quot;</span><span class="p">)</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">n_frames</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get total number of frames from Frames because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">return</span> <span class="n">n_frames</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="k">def</span> <span class="nf">_create_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="c1"># TODO : change UNIQUE(a, b)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="c1"># into primary key over both columns a and b where appropriate</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="n">db_cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="n">sql_create_Options_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="s2">            CREATE TABLE IF NOT EXISTS &quot;Options&quot; (</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="s2">            &quot;Key&quot;	TEXT NOT NULL UNIQUE,</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="s2">            &quot;Value&quot;	TEXT NOT NULL,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="s2">            &quot;Description&quot;	TEXT,</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="s2">            PRIMARY KEY(&quot;Key&quot;)</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="s2">            )</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="s2">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_Options_table</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="n">sql_create_Files_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="s2">            CREATE TABLE IF NOT EXISTS &quot;Files&quot; (</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="s2">            &quot;Id&quot;	INTEGER NOT NULL UNIQUE,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="s2">            &quot;FileName&quot;	TEXT NOT NULL UNIQUE,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="s2">            &quot;NumFrames&quot;	INTEGER NOT NULL,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="s2">            PRIMARY KEY(&quot;Id&quot; AUTOINCREMENT)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="s2">            )</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="s2">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_Files_table</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="n">sql_create_AnnotationTypes_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="s2">            CREATE TABLE IF NOT EXISTS &quot;AnnotationTypes&quot; (</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="s2">            &quot;Id&quot;	INTEGER NOT NULL UNIQUE,</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="s2">            &quot;Name&quot;	TEXT NOT NULL UNIQUE,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="s2">            &quot;Description&quot;	TEXT,</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="s2">            PRIMARY KEY(&quot;Id&quot; AUTOINCREMENT)</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="s2">            )</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="s2">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_AnnotationTypes_table</span><span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="n">sql_create_Frames_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="s2">            CREATE TABLE IF NOT EXISTS &quot;Frames&quot; (</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="s2">            &quot;Id&quot;	INTEGER NOT NULL UNIQUE,</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="s2">            &quot;FrameInFile&quot;	INTEGER NOT NULL,</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="s2">            &quot;FileId&quot;	INTEGER NOT NULL,</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="s2">            PRIMARY KEY(&quot;Id&quot; AUTOINCREMENT),</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="s2">            FOREIGN KEY(&quot;FileId&quot;) REFERENCES &quot;Files&quot;(&quot;Id&quot;)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="s2">            UNIQUE(&quot;FrameInFile&quot;, &quot;FileId&quot;)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="s2">            )</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="s2">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_Frames_table</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="n">sql_create_Cycles_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="s2">            CREATE TABLE IF NOT EXISTS &quot;Cycles&quot; (</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="s2">            &quot;Id&quot;	INTEGER NOT NULL UNIQUE,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="s2">            &quot;AnnotationTypeId&quot;	INTEGER NOT NULL UNIQUE,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="s2">            &quot;Structure&quot;	TEXT NOT NULL,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="s2">            FOREIGN KEY(&quot;AnnotationTypeId&quot;) REFERENCES &quot;AnnotationTypes&quot;(&quot;Id&quot;) ON DELETE CASCADE,</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="s2">            PRIMARY KEY(&quot;Id&quot; AUTOINCREMENT)</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="s2">            )</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="s2">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_Cycles_table</span><span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="n">sql_create_AnnotationTypeLabels_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="s2">            CREATE TABLE IF NOT EXISTS &quot;AnnotationTypeLabels&quot; (</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="s2">            &quot;Id&quot;	INTEGER NOT NULL UNIQUE,</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="s2">            &quot;AnnotationTypeId&quot;	INTEGER NOT NULL,</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="s2">            &quot;Name&quot;	TEXT NOT NULL,</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="s2">            &quot;Description&quot;	TEXT,</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="s2">            PRIMARY KEY(&quot;Id&quot; AUTOINCREMENT),</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="s2">            FOREIGN KEY(&quot;AnnotationTypeId&quot;) REFERENCES &quot;AnnotationTypes&quot;(&quot;Id&quot;) ON DELETE CASCADE,</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="s2">            UNIQUE(&quot;AnnotationTypeId&quot;,&quot;Name&quot;)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="s2">            )</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="s2">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_AnnotationTypeLabels_table</span><span class="p">)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="n">sql_create_Annotations_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="s2">            CREATE TABLE IF NOT EXISTS &quot;Annotations&quot; (</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="s2">            &quot;FrameId&quot;	INTEGER NOT NULL,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="s2">            &quot;AnnotationTypeLabelId&quot;	INTEGER NOT NULL,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="s2">            FOREIGN KEY(&quot;FrameId&quot;) REFERENCES &quot;Frames&quot;(&quot;Id&quot;),</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="s2">            FOREIGN KEY(&quot;AnnotationTypeLabelId&quot;) REFERENCES &quot;AnnotationTypeLabels&quot;(&quot;Id&quot;) ON DELETE CASCADE,</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="s2">            UNIQUE(&quot;FrameId&quot;,&quot;AnnotationTypeLabelId&quot;)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="s2">            )</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="s2">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_Annotations_table</span><span class="p">)</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="n">sql_create_CycleIterations_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="s2">            CREATE TABLE IF NOT EXISTS &quot;CycleIterations&quot; (</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="s2">            &quot;FrameId&quot;	INTEGER NOT NULL,</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="s2">            &quot;CycleId&quot;	INTEGER NOT NULL,</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="s2">            &quot;CycleIteration&quot;	INTEGER NOT NULL,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="s2">            FOREIGN KEY(&quot;CycleId&quot;) REFERENCES &quot;Cycles&quot;(&quot;Id&quot;) ON DELETE CASCADE,</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="s2">            FOREIGN KEY(&quot;FrameId&quot;) REFERENCES &quot;Frames&quot;(&quot;Id&quot;)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="s2">            UNIQUE(&quot;FrameId&quot;,&quot;CycleId&quot;)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="s2">            )</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="s2">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_CycleIterations_table</span><span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">sql_create_Volumes_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="s2">            CREATE TABLE IF NOT EXISTS &quot;Volumes&quot; (</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="s2">            &quot;FrameId&quot;	INTEGER NOT NULL UNIQUE,</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="s2">            &quot;VolumeId&quot;	INTEGER NOT NULL,</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="s2">            &quot;SliceInVolume&quot;	INTEGER NOT NULL,</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="s2">            PRIMARY KEY(&quot;FrameId&quot; AUTOINCREMENT),</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="s2">            FOREIGN KEY(&quot;FrameId&quot;) REFERENCES &quot;Frames&quot;(&quot;Id&quot;)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="s2">            UNIQUE(&quot;VolumeId&quot;,&quot;SliceInVolume&quot;)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="s2">            )</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="s2">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_Volumes_table</span><span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="n">db_cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="k">def</span> <span class="nf">_populate_Options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_manager</span><span class="p">:</span> <span class="n">FileManager</span><span class="p">,</span> <span class="n">volume_manager</span><span class="p">:</span> <span class="n">VolumeManager</span><span class="p">):</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">        Populates the Options table (a dictionary with key - value pairs).</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">        Learning resources:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">            another way of dealing with Errors :</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">            https://www.w3resource.com/python-exercises/sqlite/python-sqlite-exercise-6.php</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">            file_manager: FileManager object that provides the data to populate the tables.</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">            volume_manager: VolumeManager object that provides the data to populate the tables.</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;data_dir&quot;</span><span class="p">,</span> <span class="n">file_manager</span><span class="o">.</span><span class="n">data_dir</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()),</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                    <span class="p">(</span><span class="s2">&quot;frames_per_volume&quot;</span><span class="p">,</span> <span class="n">volume_manager</span><span class="o">.</span><span class="n">fpv</span><span class="p">),</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>                    <span class="p">(</span><span class="s2">&quot;num_head_frames&quot;</span><span class="p">,</span> <span class="n">volume_manager</span><span class="o">.</span><span class="n">n_head</span><span class="p">),</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>                    <span class="p">(</span><span class="s2">&quot;num_tail_frames&quot;</span><span class="p">,</span> <span class="n">volume_manager</span><span class="o">.</span><span class="n">n_tail</span><span class="p">),</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>                    <span class="p">(</span><span class="s2">&quot;num_full_volumes&quot;</span><span class="p">,</span> <span class="n">volume_manager</span><span class="o">.</span><span class="n">full_volumes</span><span class="p">)]</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>                <span class="s2">&quot;INSERT INTO Options (Key, Value) VALUES (?, ?)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                <span class="n">row_data</span><span class="p">)</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to Options because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="k">def</span> <span class="nf">_populate_Files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_manager</span><span class="p">:</span> <span class="n">FileManager</span><span class="p">):</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">        Populates the Files table with</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        file_name : list with filenames per file (str), and</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        num_frames : list with number of frames per file (int)</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">            file_manager: FileManager object that provides the data to populate the tables.</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">filename</span><span class="p">,</span> <span class="n">frames</span><span class="p">)</span> <span class="k">for</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>                    <span class="n">filename</span><span class="p">,</span> <span class="n">frames</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">file_manager</span><span class="o">.</span><span class="n">file_names</span><span class="p">,</span> <span class="n">file_manager</span><span class="o">.</span><span class="n">num_frames</span><span class="p">)]</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                <span class="s2">&quot;INSERT INTO Files (FileName, NumFrames) VALUES (?, ?)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                <span class="n">row_data</span><span class="p">)</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to Files because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="k">def</span> <span class="nf">_populate_Frames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_manager</span><span class="p">:</span> <span class="n">FrameManager</span><span class="p">):</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">        Populates the Frames table with</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">        frame_in_file and frame_to_file mapping.</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">        Learning Resourses:</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">            Something like</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">            insert into tab2 (id_customers, value)</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">            values ((select id from tab1 where customers=&#39;john&#39;), &#39;alfa&#39;);</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">            but in SQLite</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">            https://www.tutorialspoint.com/sqlite/sqlite_insert_query.htm</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">            frame_manager: FrameManager object that provides the data to populate the tables.</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="c1"># adding +1 since the frame_to_file is indexing files from 0 and sqlite gave files IDs from 1</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">frame_in_file</span><span class="p">,</span> <span class="n">frame_to_file</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                    <span class="n">frame_in_file</span><span class="p">,</span> <span class="n">frame_to_file</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">frame_manager</span><span class="o">.</span><span class="n">frame_in_file</span><span class="p">,</span> <span class="n">frame_manager</span><span class="o">.</span><span class="n">frame_to_file</span><span class="p">)]</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>                <span class="s2">&quot;INSERT INTO Frames (FrameInFile, FileId) VALUES (?, ?)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>                <span class="n">row_data</span><span class="p">)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to Frames because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="k">def</span> <span class="nf">_populate_Volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume_manager</span><span class="p">:</span> <span class="n">VolumeManager</span><span class="p">):</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">        Populates the Volumes table with</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">        volume_id and slice_in_volume mapping.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">            volume_manager: VolumeManager object that provides the data to populate the tables.</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">volume_id</span><span class="p">,</span> <span class="n">slice_in_volume</span><span class="p">)</span> <span class="k">for</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>                    <span class="n">volume_id</span><span class="p">,</span> <span class="n">slice_in_volume</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">volume_manager</span><span class="o">.</span><span class="n">frame_to_vol</span><span class="p">,</span> <span class="n">volume_manager</span><span class="o">.</span><span class="n">frame_to_z</span><span class="p">)]</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                <span class="s2">&quot;INSERT INTO Volumes (VolumeId, SliceInVolume) VALUES (?, ?)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                <span class="n">row_data</span><span class="p">)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to Volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="k">def</span> <span class="nf">_populate_AnnotationTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation</span><span class="p">:</span> <span class="n">Annotation</span><span class="p">):</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">        Populates the AnnotationTypes table with</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">        annotation.name, annotation.info mapping.</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">            volume_manager: VolumeManager object that provides the data to populate the tables.</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="n">row_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">annotation</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                <span class="s2">&quot;INSERT INTO AnnotationTypes (Name, Description) VALUES (?, ?)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>                <span class="n">row_data</span><span class="p">)</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to AnnotationTypes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="k">def</span> <span class="nf">_populate_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation</span><span class="p">):</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">label</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>                    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">annotation</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">states</span><span class="p">]</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>                <span class="s2">&quot;INSERT INTO AnnotationTypeLabels (AnnotationTypeId, Name, Description) &quot;</span> <span class="o">+</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>                <span class="s2">&quot;VALUES((SELECT Id FROM AnnotationTypes WHERE Name = ?), ?, ?)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                <span class="n">row_data</span><span class="p">)</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to AnnotationTypeLabels because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="k">def</span> <span class="nf">_populate_Annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation</span><span class="p">):</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="n">n_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_n_frames</span><span class="p">()</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="k">assert</span> <span class="n">n_frames</span> <span class="o">==</span> <span class="n">annotation</span><span class="o">.</span><span class="n">n_frames</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Number of frames in the annotation, </span><span class="si">{</span><span class="n">annotation</span><span class="o">.</span><span class="n">n_frames</span><span class="si">}</span><span class="s2">,&quot;</span> \
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                                                <span class="sa">f</span><span class="s2">&quot;doesn&#39;t match&quot;</span> \
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>                                                <span class="sa">f</span><span class="s2">&quot; the expected number of frames </span><span class="si">{</span><span class="n">n_frames</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="n">frames</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">group</span><span class="p">)</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>                    <span class="k">for</span> <span class="n">frame</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">annotation</span><span class="o">.</span><span class="n">frame_to_label</span><span class="p">)]</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>                <span class="s2">&quot;INSERT INTO Annotations (FrameId, AnnotationTypeLabelId) &quot;</span> <span class="o">+</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>                <span class="s2">&quot;VALUES(?, (SELECT Id FROM AnnotationTypeLabels &quot;</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                <span class="s2">&quot;WHERE Name = ? &quot;</span> <span class="o">+</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                <span class="s2">&quot;AND AnnotationTypeId = (SELECT Id FROM AnnotationTypes &quot;</span> <span class="o">+</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>                <span class="s2">&quot;WHERE Name = ?)))&quot;</span><span class="p">,</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>                <span class="n">row_data</span><span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write group </span><span class="si">{</span><span class="n">annotation</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> to Annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="k">def</span> <span class="nf">_populate_Cycles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation</span><span class="p">):</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>        <span class="k">assert</span> <span class="n">annotation</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Annotation is not a Cycle&quot;</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="n">row_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">annotation</span><span class="o">.</span><span class="n">cycle</span><span class="o">.</span><span class="n">to_json</span><span class="p">())</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                <span class="s2">&quot;INSERT INTO Cycles (AnnotationTypeId, Structure) &quot;</span> <span class="o">+</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                <span class="s2">&quot;VALUES((SELECT Id FROM AnnotationTypes WHERE Name = ?), ?)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>                <span class="n">row_data</span><span class="p">)</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to Cycles because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>    <span class="k">def</span> <span class="nf">_populate_CycleIterations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation</span><span class="p">):</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>        <span class="n">n_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_n_frames</span><span class="p">()</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="k">assert</span> <span class="n">n_frames</span> <span class="o">==</span> <span class="n">annotation</span><span class="o">.</span><span class="n">n_frames</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Number of frames in the annotation, </span><span class="si">{</span><span class="n">annotation</span><span class="o">.</span><span class="n">n_frames</span><span class="si">}</span><span class="s2">,&quot;</span> \
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>                                                <span class="sa">f</span><span class="s2">&quot;doesn&#39;t match&quot;</span> \
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>                                                <span class="sa">f</span><span class="s2">&quot; the expected number of frames </span><span class="si">{</span><span class="n">n_frames</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="c1"># get cycle id by annotation type</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>            <span class="s2">&quot;SELECT Id FROM Cycles &quot;</span> <span class="o">+</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>            <span class="s2">&quot;WHERE AnnotationTypeId = (SELECT Id FROM AnnotationTypes &quot;</span> <span class="o">+</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="s2">&quot;WHERE Name = ?)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">name</span><span class="p">,))</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>        <span class="n">cycle_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="k">assert</span> <span class="n">cycle_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Fill out AnnotationTypes and Cycles first.&quot;</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="c1"># prepare rows</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="n">frames</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cycle_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iteration</span><span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>                    <span class="k">for</span> <span class="n">frame</span><span class="p">,</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">annotation</span><span class="o">.</span><span class="n">frame_to_cycle</span><span class="p">)]</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>        <span class="c1"># insert into CycleIterations</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>                <span class="s2">&quot;INSERT INTO CycleIterations (FrameId, CycleId, CycleIteration) &quot;</span> <span class="o">+</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>                <span class="s2">&quot;VALUES(?, ?,?)&quot;</span><span class="p">,</span> <span class="n">row_data</span><span class="p">)</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write group </span><span class="si">{</span><span class="n">annotation</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> to CycleIterations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbWriter.add_annotations" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_annotations</span><span class="p">(</span><span class="n">annotations</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Adds a list of annotations to the database.
Does NOT save the database after adding.
To keep this change in the future, you need to save the database after adding.
Args:
    annotations: mapping of frames to labels, list of annotations</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="k">def</span> <span class="nf">add_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Annotation</span><span class="p">]):</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    Adds a list of annotations to the database.</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    Does NOT save the database after adding.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    To keep this change in the future, you need to save the database after adding.</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        annotations: mapping of frames to labels, list of annotations</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="c1"># TODO : add list checking</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_AnnotationTypes</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_AnnotationTypeLabels</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Annotations</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">if</span> <span class="n">annotation</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Cycles</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_CycleIterations</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbWriter.create" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates an empty DB for the experiment in memory.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    Creates an empty DB for the experiment in memory.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="c1"># For an in-memory only database:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">memory_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbWriter.delete_annotation" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">delete_annotation</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Deletes annotation from all the tables.
Deletion by "ON DELETE CASCADE" from AnnotationTypes, AnnotationTypeLabels, Annotations,
Cycles, CycleIterations.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="k">def</span> <span class="nf">delete_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    Deletes annotation from all the tables.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">    Deletion by &quot;ON DELETE CASCADE&quot; from AnnotationTypes, AnnotationTypeLabels, Annotations,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    Cycles, CycleIterations.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="c1"># get the volumes</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT * FROM AnnotationTypes WHERE Name = ?&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;No annotation </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in the database.&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;DELETE FROM AnnotationTypes </span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="s2">                        WHERE Name = ?&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not delete_annotation because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbWriter.load" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Load the contents of a database file on disk to a
transient copy in memory without modifying the file.</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    Load the contents of a database file on disk to a</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    transient copy in memory without modifying the file.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">disk_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">memory_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">disk_db</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">disk_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="c1"># Now use `memory_db` without modifying disk db</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbWriter.populate" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">populate</span><span class="p">(</span><span class="n">volumes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">annotations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates the tables if they don't exist and fills with the provided data.
Args:
    volumes: mapping of frames to volumes, and to slices in volumes, frames per volume
    annotations: mapping of frames to labels, list of annotations</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volumes</span><span class="p">:</span> <span class="n">VolumeManager</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">annotations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Annotation</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    Creates the tables if they don&#39;t exist and fills with the provided data.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        volumes: mapping of frames to volumes, and to slices in volumes, frames per volume</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        annotations: mapping of frames to labels, list of annotations</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="c1"># will only create if they don&#39;t exist</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_create_tables</span><span class="p">()</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="c1"># TODO : write cases for files and frames not None</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">if</span> <span class="n">volumes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Options</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">file_manager</span><span class="p">,</span> <span class="n">volumes</span><span class="p">)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Files</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">file_manager</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Frames</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">frame_manager</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Volumes</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">if</span> <span class="n">annotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_annotations</span><span class="p">(</span><span class="n">annotations</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.vodex.dbmethods.DbWriter.save" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Backup a database to a file.
Will CLOSE connection to the database in memory!
Args:
    file_name : the name of the file to save database to, EX.: 'databasename.db'</p>

          <details class="quote">
            <summary>Source code in <code>src/vodex/dbmethods.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    Backup a database to a file.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    Will CLOSE connection to the database in memory!</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        file_name : the name of the file to save database to, EX.: &#39;databasename.db&#39;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="k">def</span> <span class="nf">progress</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">remaining</span><span class="p">,</span> <span class="n">total</span><span class="p">):</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Copied </span><span class="si">{</span><span class="n">total</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">remaining</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s1"> pages...&#39;</span><span class="p">)</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">backup_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="k">with</span> <span class="n">backup_db</span><span class="p">:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">backup_db</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="c1"># self.connection.close()</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="n">backup_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../annotation/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Annotation">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Annotation
              </div>
            </div>
          </a>
        
        
          
          <a href="../loaders/" class="md-footer__link md-footer__link--next" aria-label="Next: Loaders">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Loaders
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 - 2023 Anna Nadtochiy
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/LemonJust" target="_blank" rel="noopener" title="LemonJust on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linkedin.com/in/anna-nadtochiy/" target="_blank" rel="noopener" title="LemonJust (Anna Nadtochiy) on LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.indexes", "navigation.top", "navigation.instant", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "navigation.footer", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>