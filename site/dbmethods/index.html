<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>DataBase methods - VoDEx Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../assets/_mkdocstrings.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">VoDEx Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../tutorials/" class="nav-link">Tutorials</a>
                            </li>
                            <li class="navitem">
                                <a href="../how-to-guides/" class="nav-link">How-To Guides</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../reference/" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../loaders/" class="dropdown-item">Loaders</a>
</li>
                                    
<li>
    <a href="../core/" class="dropdown-item">Core</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">DataBase methods</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../explanation/" class="nav-link">Explanation</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                            <li class="nav-item">
                                <a rel="prev" href="../core/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../explanation/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#vodexdbmethods-module" class="nav-link">vodex.dbmethods module</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#src.vodex.dbmethods" class="nav-link">src.vodex.dbmethods</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#src.vodex.dbmethods.DbExporter" class="nav-link">DbExporter</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#src.vodex.dbmethods.DbReader" class="nav-link">DbReader</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#src.vodex.dbmethods.DbWriter" class="nav-link">DbWriter</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="vodexdbmethods-module">vodex.dbmethods module</h1>


<div class="doc doc-object doc-module">


<a id="src.vodex.dbmethods"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.vodex.dbmethods.DbExporter" class="doc doc-heading">
        <code>DbExporter</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Transforms the information from the database into the core classes.</p>


        <details class="quote">
          <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DbExporter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms the information from the database into the core classes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO : make it work for annotations</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_reader</span><span class="p">:</span> <span class="n">DbReader</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db_reader</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a database from a file and initialises a DbExporter.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_name: full path to a file to database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">db_reader</span> <span class="o">=</span> <span class="n">DbReader</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">db_reader</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reconstruct_file_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates file manager from the database records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_data_dir</span><span class="p">()</span>
        <span class="n">file_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_file_names</span><span class="p">()</span>
        <span class="n">frames_per_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_frames_per_file</span><span class="p">()</span>

        <span class="n">fm</span> <span class="o">=</span> <span class="n">FileManager</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">file_names</span><span class="o">=</span><span class="n">file_names</span><span class="p">,</span> <span class="n">frames_per_file</span><span class="o">=</span><span class="n">frames_per_file</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fm</span>

    <span class="k">def</span> <span class="nf">reconstruct_volume_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates volume manager from the database records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_file_manager</span><span class="p">()</span>
        <span class="n">fpv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_fpv</span><span class="p">()</span>
        <span class="n">fgf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_fgf</span><span class="p">()</span>
        <span class="n">vm</span> <span class="o">=</span> <span class="n">VolumeManager</span><span class="p">(</span><span class="n">fpv</span><span class="p">,</span> <span class="n">FrameManager</span><span class="p">(</span><span class="n">fm</span><span class="p">),</span> <span class="n">fgf</span><span class="o">=</span><span class="n">fgf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vm</span>

    <span class="k">def</span> <span class="nf">reconstruct_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates labels corresponding to the specified annotation from the database records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state_names</span><span class="p">,</span> <span class="n">state_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_Name_and_Description_from_AnnotationTypeLabels</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">Labels</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">state_names</span><span class="p">,</span> <span class="n">state_info</span><span class="o">=</span><span class="n">state_info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span> <span class="nf">reconstruct_timeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">itertools</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates timeline corresponding to the specified annotation from the database records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get the mapping between the names and the Ids</span>
        <span class="n">label_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_Id_map_to_Names_from_AnnotationTypeLabels</span><span class="p">()</span>
        <span class="c1"># get all the labels that were used in the annotation ( does not reconstruct unused Labels )</span>
        <span class="n">labels_per_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_AnnotationTypeLabelId_from_Annotations</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

        <span class="n">label_order</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">label_id</span><span class="p">,</span> <span class="n">frames</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">labels_per_frame</span><span class="p">):</span>
            <span class="n">label_name</span> <span class="o">=</span> <span class="n">label_names</span><span class="p">[</span><span class="n">label_id</span><span class="p">]</span>
            <span class="n">label_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">label_name</span><span class="p">))</span>
            <span class="n">duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">))</span>

        <span class="n">timeline</span> <span class="o">=</span> <span class="n">Timeline</span><span class="p">(</span><span class="n">label_order</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">timeline</span>

    <span class="k">def</span> <span class="nf">reconstruct_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates cycle corresponding to the specified annotation from the database records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cycle_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_Structure_from_Cycle</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cycle_json</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cycle</span> <span class="o">=</span> <span class="n">Cycle</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">cycle_json</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cycle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">cycle</span>

    <span class="k">def</span> <span class="nf">reconstruct_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates annotations from the database records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get the names of all the available annotations from the db</span>
        <span class="n">annotation_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_Names_from_AnnotationTypes</span><span class="p">()</span>
        <span class="c1"># get the total number of frames in the recording</span>
        <span class="n">n_frames</span> <span class="o">=</span> <span class="n">FrameManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_file_manager</span><span class="p">())</span><span class="o">.</span><span class="n">n_frames</span>

        <span class="n">annotations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">annotation_names</span><span class="p">:</span>
            <span class="c1"># reconstruct Labels for the group</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_labels</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="c1"># try to get a cycle</span>
            <span class="n">cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_cycle</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="c1"># define the annotation type ( Cycle / Timeline)</span>
            <span class="k">if</span> <span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">annotation</span> <span class="o">=</span> <span class="n">Annotation</span><span class="o">.</span><span class="n">from_cycle</span><span class="p">(</span><span class="n">n_frames</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">cycle</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_timeline</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
                <span class="n">annotation</span> <span class="o">=</span> <span class="n">Annotation</span><span class="o">.</span><span class="n">from_timeline</span><span class="p">(</span><span class="n">n_frames</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">timeline</span><span class="p">)</span>

            <span class="n">annotations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">annotations</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbExporter.load" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Loads a database from a file and initialises a DbExporter.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>file_name</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="src.vodex.core.Path">Path</span>, str]</code>
          </td>
          <td><p>full path to a file to database.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads a database from a file and initialises a DbExporter.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name: full path to a file to database.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">db_reader</span> <span class="o">=</span> <span class="n">DbReader</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">db_reader</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbExporter.reconstruct_annotations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reconstruct_annotations</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates annotations from the database records.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reconstruct_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates annotations from the database records.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get the names of all the available annotations from the db</span>
    <span class="n">annotation_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_Names_from_AnnotationTypes</span><span class="p">()</span>
    <span class="c1"># get the total number of frames in the recording</span>
    <span class="n">n_frames</span> <span class="o">=</span> <span class="n">FrameManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_file_manager</span><span class="p">())</span><span class="o">.</span><span class="n">n_frames</span>

    <span class="n">annotations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">annotation_names</span><span class="p">:</span>
        <span class="c1"># reconstruct Labels for the group</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_labels</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="c1"># try to get a cycle</span>
        <span class="n">cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_cycle</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="c1"># define the annotation type ( Cycle / Timeline)</span>
        <span class="k">if</span> <span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">annotation</span> <span class="o">=</span> <span class="n">Annotation</span><span class="o">.</span><span class="n">from_cycle</span><span class="p">(</span><span class="n">n_frames</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">cycle</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">timeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_timeline</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
            <span class="n">annotation</span> <span class="o">=</span> <span class="n">Annotation</span><span class="o">.</span><span class="n">from_timeline</span><span class="p">(</span><span class="n">n_frames</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">timeline</span><span class="p">)</span>

        <span class="n">annotations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">annotations</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbExporter.reconstruct_cycle" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reconstruct_cycle</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates cycle corresponding to the specified annotation from the database records.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reconstruct_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates cycle corresponding to the specified annotation from the database records.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cycle_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_Structure_from_Cycle</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cycle_json</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cycle</span> <span class="o">=</span> <span class="n">Cycle</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">cycle_json</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cycle</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">cycle</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbExporter.reconstruct_file_manager" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reconstruct_file_manager</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates file manager from the database records.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reconstruct_file_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates file manager from the database records.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_data_dir</span><span class="p">()</span>
    <span class="n">file_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_file_names</span><span class="p">()</span>
    <span class="n">frames_per_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_frames_per_file</span><span class="p">()</span>

    <span class="n">fm</span> <span class="o">=</span> <span class="n">FileManager</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">file_names</span><span class="o">=</span><span class="n">file_names</span><span class="p">,</span> <span class="n">frames_per_file</span><span class="o">=</span><span class="n">frames_per_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fm</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbExporter.reconstruct_labels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reconstruct_labels</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates labels corresponding to the specified annotation from the database records.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reconstruct_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates labels corresponding to the specified annotation from the database records.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state_names</span><span class="p">,</span> <span class="n">state_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_Name_and_Description_from_AnnotationTypeLabels</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">Labels</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">state_names</span><span class="p">,</span> <span class="n">state_info</span><span class="o">=</span><span class="n">state_info</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">labels</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbExporter.reconstruct_volume_manager" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reconstruct_volume_manager</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates volume manager from the database records.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reconstruct_volume_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates volume manager from the database records.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_file_manager</span><span class="p">()</span>
    <span class="n">fpv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_fpv</span><span class="p">()</span>
    <span class="n">fgf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_fgf</span><span class="p">()</span>
    <span class="n">vm</span> <span class="o">=</span> <span class="n">VolumeManager</span><span class="p">(</span><span class="n">fpv</span><span class="p">,</span> <span class="n">FrameManager</span><span class="p">(</span><span class="n">fm</span><span class="p">),</span> <span class="n">fgf</span><span class="o">=</span><span class="n">fgf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vm</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.vodex.dbmethods.DbReader" class="doc doc-heading">
        <code>DbReader</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Reads information from the database.
Database interface that abstracts the SQLite calls.</p>


        <details class="quote">
          <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DbReader</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads information from the database.</span>
<span class="sd">    Database interface that abstracts the SQLite calls.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA foreign_keys = 1&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_n_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT COUNT(*) FROM Frames&quot;</span><span class="p">)</span>
            <span class="n">n_frames</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get total number of frames from Frames because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">n_frames</span>

        <span class="c1"># get the volumes</span>

    <span class="k">def</span> <span class="nf">get_data_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get data directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<span class="s2">                     WHERE Key = &quot;data_dir&quot; &quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="n">data_dir</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_data_dir because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">data_dir</span>

    <span class="k">def</span> <span class="nf">get_fpv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get frames per volume</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<span class="s2">                     WHERE Key = &quot;frames_per_volume&quot; &quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="n">fpv</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_fpv because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fpv</span>

    <span class="k">def</span> <span class="nf">get_fgf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get frames per volume</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<span class="s2">                     WHERE Key = &quot;num_head_frames&quot; &quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="n">fdf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_fgf because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fdf</span>

    <span class="k">def</span> <span class="nf">get_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the information from the OPTIONS table.</span>
<span class="sd">        Returns a dictionary with the Key: Value from the table.</span>
<span class="sd">        ( Keys: &#39;data_dir&#39;, &#39;frames_per_volume&#39;, &#39;num_head_frames&#39;, &#39;num_tail_frames&#39;, &#39;num_full_volumes&#39; )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT * FROM Options&quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                <span class="n">options</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_options because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">options</span>

    <span class="k">def</span> <span class="nf">get_file_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the file names from the Files table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FileName FROM Files ORDER BY Id ASC&quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_file_names because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">file_names</span>

    <span class="k">def</span> <span class="nf">get_frames_per_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the file names from the Files table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT NumFrames FROM Files ORDER BY Id ASC&quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="n">frames_per_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_frames_per_file because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">frames_per_file</span>

    <span class="k">def</span> <span class="nf">get_volume_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all the volumes.</span>
<span class="sd">        :return: list of all the volumes</span>
<span class="sd">        :rtype: [int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT DISTINCT VolumeId FROM Volumes&quot;</span><span class="p">)</span>
            <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get total number of frames from Frames because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">volume_ids</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the contents of a database file on disk to a</span>
<span class="sd">        transient copy in memory without modifying the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">disk_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">memory_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
        <span class="n">disk_db</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
        <span class="n">disk_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># Now use `memory_db` without modifying disk db</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">choose_full_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Chooses the frames from specified frames, that also correspond to full volumes.</span>

<span class="sd">        The order of the frames is not preserved!</span>
<span class="sd">        The result will correspond to frames sorted in increasing order !</span>

<span class="sd">        :param frames: a list of frame IDs</span>
<span class="sd">        :type frames: [int]</span>
<span class="sd">        :param fpv: frames per volume</span>
<span class="sd">        :type fpv: int</span>
<span class="sd">        :return: frames IDs from frames. corresponding to slices</span>
<span class="sd">        :rtype: [int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create list of frame Ids</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
        <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">)</span>

        <span class="c1"># get the volumes</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># get n_volumes (frames per volume)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<span class="s2">                    WHERE Key = &quot;frames_per_volume&quot; &quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="n">fpv</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># get ids of full volumes in the provided frames</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT VolumeId FROM</span>
<span class="s2">                    (</span>
<span class="s2">                    SELECT VolumeId, count(VolumeId) as N</span>
<span class="s2">                    FROM Volumes</span>
<span class="s2">                    WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                    GROUP BY VolumeId</span>
<span class="s2">                    )</span>
<span class="s2">                    WHERE N = ?&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="p">(</span><span class="n">fpv</span><span class="p">,)</span>
            <span class="p">)</span>
            <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
            <span class="n">n_volumes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">)</span>

            <span class="c1"># get all frames from frames that correspond to full volumes</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Volumes</span>
<span class="s2">                    WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                    AND VolumeId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_volumes</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not choose_full_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">volume_ids</span><span class="p">,</span> <span class="n">frame_ids</span>

    <span class="k">def</span> <span class="nf">choose_frames_per_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">slices</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Chooses the frames from specified frames, that also correspond to the same slices (continuously)</span>
<span class="sd">        in different volumes.</span>
<span class="sd">        For example, if slices = [2,3,4] it will choose such frames from &quot;given frames&quot; that also correspond</span>
<span class="sd">        to a chunk from slice 2 to slice 4 in all the volumes.</span>
<span class="sd">        If there is a frame that corresponds to a slice &quot;2&quot; in a volume,</span>
<span class="sd">        but no frames corresponding to the slices &quot;3&quot; and &quot;4&quot; in the SAME volume, such frame will not be picked.</span>

<span class="sd">        The order of the frames is not preserved!</span>
<span class="sd">        The result will correspond to frames sorted in increasing order !</span>

<span class="sd">        :param frames: a list of frame IDs</span>
<span class="sd">        :type frames: [int]</span>
<span class="sd">        :param slices: a list of slice IDs, order will not be preserved: will be sorted in increasing order</span>
<span class="sd">        :type slices: [int]</span>
<span class="sd">        :return: frames IDs from frames. corresponding to slices</span>
<span class="sd">        :rtype: [int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create list of frame Ids</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
        <span class="n">slice_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
        <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">)</span>
        <span class="n">n_slices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>

        <span class="c1"># get the volumes</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Volumes</span>
<span class="s2">                    WHERE FrameId in (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                    AND SliceInVolume IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_slices</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                    AND VolumeId IN</span>
<span class="s2">                        (</span>
<span class="s2">                        SELECT VolumeId FROM</span>
<span class="s2">                            (</span>
<span class="s2">                            SELECT VolumeId, count(VolumeId) as N </span>
<span class="s2">                            FROM Volumes </span>
<span class="s2">                            WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                            AND SliceInVolume IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_slices</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                            GROUP BY VolumeId</span>
<span class="s2">                            )</span>
<span class="s2">                        WHERE N = ?</span>
<span class="s2">                        )&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="n">slice_ids</span> <span class="o">+</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="n">slice_ids</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_slices</span><span class="p">,)</span>
            <span class="p">)</span>

            <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not choose_frames_per_slices because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">frame_ids</span>

    <span class="k">def</span> <span class="nf">prepare_frames_for_loading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds all the information needed</span>
<span class="sd">        1) to load the frames</span>
<span class="sd">        2) and shape them back into volumes/slices.</span>
<span class="sd">        For each frame returns the image file,</span>
<span class="sd">        frame location on the image and corresponding volume.</span>

<span class="sd">        The order is not preserved!</span>
<span class="sd">        the volume correspond to sorted volumes in increasing order !</span>

<span class="sd">        :param frames: a list of frame IDs</span>
<span class="sd">        :type frames: [int]</span>
<span class="sd">        :return: three lists, the length of the frames :</span>
<span class="sd">                data directory, file names,</span>
<span class="sd">                image files, frame location on the image, volumes.</span>
<span class="sd">        :rtype: str, [str], [str],[int],[int]</span>
<span class="sd">        # TODO : break into functions that get the file locations and the stuff relevant to the frames</span>
<span class="sd">        # TODO : make one &quot; prepare volumes &quot; for loading?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>

        <span class="c1"># get the frames</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># get data directory</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value</span>
<span class="s2">                    FROM Options</span>
<span class="s2">                    WHERE Key = &quot;data_dir&quot; &quot;&quot;&quot;</span><span class="p">)</span>
            <span class="n">data_dir</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># get file_names</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FileName</span>
<span class="s2">                    FROM Files &quot;&quot;&quot;</span><span class="p">)</span>
            <span class="n">file_names</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

            <span class="c1"># get info for every frame</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT </span>
<span class="s2">                        FileId,</span>
<span class="s2">                        FrameInFile,</span>
<span class="s2">                        VolumeId</span>
<span class="s2">                    FROM </span>
<span class="s2">                        Frames</span>
<span class="s2">                        INNER JOIN Volumes </span>
<span class="s2">                        ON Frames.Id = Volumes.FrameId</span>
<span class="s2">                    WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">))</span>
            <span class="n">frame_info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not prepare_frames_for_loading because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">]</span>

        <span class="n">file_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">frame_info</span><span class="p">]</span>
        <span class="n">frame_in_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">frame_info</span><span class="p">]</span>
        <span class="n">volumes</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">frame_info</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">data_dir</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">file_ids</span><span class="p">,</span> <span class="n">frame_in_file</span><span class="p">,</span> <span class="n">volumes</span>

    <span class="k">def</span> <span class="nf">get_frames_per_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume_ids</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds all the frames that correspond to the specified volumes.</span>
<span class="sd">        The order is not preserved!</span>
<span class="sd">        the volume correspond to sorted volumes in increasing order !</span>

<span class="sd">        :param volume_ids: a list of volume IDs</span>
<span class="sd">        :type volume_ids: [int]</span>
<span class="sd">        :return: frame IDs</span>
<span class="sd">        :rtype: [int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">list_of_int</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">)</span>

        <span class="c1"># get the frames</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Volumes </span>
<span class="s2">                    WHERE VolumeId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span>
            <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_FrameId_from_Volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># TODO : get rid of list of tuples?</span>
        <span class="c1">#  https://www.reddit.com/r/Python/comments/2iiqri/quick_question_why_are_sqlite_fields_returned_as/</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">frame_ids</span>

    <span class="k">def</span> <span class="nf">get_and_frames_per_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Chooses the frames that correspond to the specified conditions on annotation. Using &quot;and&quot; logic. Example : if</span>
<span class="sd">        you ask for frames corresponding to condition 1 and condition 2 , it will return such frames that both</span>
<span class="sd">        condition 1 and condition 2 are True AT THE SAME TIME</span>

<span class="sd">        :param conditions: a list of conditions on the annotation labels</span>
<span class="sd">        in a form [(group, name),(group, name), ...] where group is a string for the annotation type</span>
<span class="sd">        and name is the name of the label of that annotation type. For example [(&#39;light&#39;, &#39;on&#39;), (&#39;shape&#39;,&#39;c&#39;)]</span>
<span class="sd">        :type conditions: [tuple]</span>
<span class="sd">        :return: list of frame Ids that satisfy all the conditions, if there are no such frames, an empty list</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create list of label Ids</span>
        <span class="n">labels_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">label_info</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
            <span class="n">labels_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_Id_from_AnnotationTypeLabels</span><span class="p">(</span><span class="n">label_info</span><span class="p">))</span>
        <span class="n">labels_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>
        <span class="n">n_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>

        <span class="c1"># get the frames</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM </span>
<span class="s2">                    (SELECT FrameId, count(FrameId) as N </span>
<span class="s2">                    FROM Annotations </span>
<span class="s2">                    WHERE AnnotationTypeLabelId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_labels</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                    GROUP BY FrameId)</span>
<span class="s2">                    WHERE N = </span><span class="si">{</span><span class="n">n_labels</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">labels_ids</span><span class="p">)</span>
            <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_and_FrameId_from_Annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># TODO : get rid of list of tuples?</span>
        <span class="c1">#  https://www.reddit.com/r/Python/comments/2iiqri/quick_question_why_are_sqlite_fields_returned_as/</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">frame_ids</span>

    <span class="k">def</span> <span class="nf">get_or_frames_per_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Chooses the frames that correspond to the specified conditions on annotation. Using &quot;or&quot; logic. Example : if</span>
<span class="sd">        you ask for frames corresponding to condition 1 and condition 2 , it will return such frames that either</span>
<span class="sd">        condition 1 is true OR condition 2 is True OR both are true.</span>

<span class="sd">        :param conditions: a list of conditions on the annotation labels</span>
<span class="sd">        in a form [(group, name),(group, name), ...] where group is a string for the annotation type</span>
<span class="sd">        and name is the name of the label of that annotation type. For example [(&#39;light&#39;, &#39;on&#39;), (&#39;shape&#39;,&#39;c&#39;)]</span>
<span class="sd">        :type conditions: [tuple]</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create list of label Ids</span>
        <span class="n">labels_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">label_info</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
            <span class="n">labels_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_Id_from_AnnotationTypeLabels</span><span class="p">(</span><span class="n">label_info</span><span class="p">))</span>
        <span class="n">labels_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>
        <span class="n">n_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>

        <span class="c1"># get the frames</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Annotations </span>
<span class="s2">                    WHERE AnnotationTypeLabelId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_labels</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                    GROUP BY FrameId&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">labels_ids</span><span class="p">)</span>
            <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_or_FrameId_from_Annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># TODO : get rid of list of tuples?</span>
        <span class="c1">#  https://www.reddit.com/r/Python/comments/2iiqri/quick_question_why_are_sqlite_fields_returned_as/</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">frame_ids</span>

    <span class="k">def</span> <span class="nf">get_conditionIds_per_cycle_per_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of condition IDs that correspond to each volume, list of corresponding volumes</span>
<span class="sd">        and a count of the volume-condition pairs</span>
<span class="sd">        annotation_name: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO : check if empty</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT VolumeId, AnnotationTypeLabelId, count(VolumeId) FROM</span>
<span class="s2">                    CycleIterations </span>
<span class="s2">                    INNER JOIN Volumes ON CycleIterations.FrameId = Volumes.FrameId </span>
<span class="s2">                    INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<span class="s2">                    WHERE AnnotationTypeLabelId in </span>
<span class="s2">                        (</span>
<span class="s2">                        SELECT Id from AnnotationTypeLabels </span>
<span class="s2">                        WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                        )</span>
<span class="s2">                    AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                    AND CycleIteration = 0</span>
<span class="s2">                    GROUP BY VolumeId, AnnotationTypeLabelId</span>
<span class="s2">                    ORDER BY VolumeId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="c1"># TODO : check if empty</span>
            <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
            <span class="n">condition_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
            <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_conditions_per_cycle_per_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">volume_ids</span><span class="p">,</span> <span class="n">condition_ids</span><span class="p">,</span> <span class="n">count</span>

    <span class="k">def</span> <span class="nf">get_conditionIds_per_cycle_per_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of condition IDs that correspond to each frame, list of corresponding frames.</span>
<span class="sd">        annotation_name: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO : check if empty</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT CycleIterations.FrameId, AnnotationTypeLabelId FROM</span>
<span class="s2">                    CycleIterations </span>
<span class="s2">                    INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<span class="s2">                    WHERE AnnotationTypeLabelId in </span>
<span class="s2">                        (</span>
<span class="s2">                        SELECT Id from AnnotationTypeLabels </span>
<span class="s2">                        WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                        )</span>
<span class="s2">                    AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                    AND CycleIteration = 0</span>
<span class="s2">                    ORDER BY CycleIterations.FrameId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="c1"># TODO : check if empty</span>
            <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
            <span class="n">condition_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_conditionIds_per_cycle_per_frame because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">frame_ids</span><span class="p">,</span> <span class="n">condition_ids</span>

    <span class="k">def</span> <span class="nf">get_cycleIterations_per_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of cycleIterations that correspond to each volume, list of corresponding volumes</span>
<span class="sd">        and a count of the volume-iteration pairs</span>
<span class="sd">        annotation_name: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO : check if empty</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT VolumeId, CycleIteration, count(VolumeId) FROM</span>
<span class="s2">                    CycleIterations </span>
<span class="s2">                    INNER JOIN Volumes ON CycleIterations.FrameId = Volumes.FrameId </span>
<span class="s2">                    INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<span class="s2">                    WHERE AnnotationTypeLabelId in </span>
<span class="s2">                        (</span>
<span class="s2">                        SELECT Id from AnnotationTypeLabels </span>
<span class="s2">                        WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                        )</span>
<span class="s2">                    AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                    GROUP BY VolumeId</span>
<span class="s2">                    ORDER BY VolumeId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="c1"># TODO : check if empty</span>
            <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
            <span class="n">cycle_its</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
            <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_cycleIterations_per_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">volume_ids</span><span class="p">,</span> <span class="n">cycle_its</span><span class="p">,</span> <span class="n">count</span>

    <span class="k">def</span> <span class="nf">get_cycleIterations_per_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of cycle iterations that correspond to each frame, list of corresponding frames.</span>
<span class="sd">        annotation_name: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO : check if empty</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT CycleIterations.FrameId, CycleIteration FROM</span>
<span class="s2">                    CycleIterations </span>
<span class="s2">                    INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<span class="s2">                    WHERE AnnotationTypeLabelId in </span>
<span class="s2">                        (</span>
<span class="s2">                        SELECT Id from AnnotationTypeLabels </span>
<span class="s2">                        WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                        )</span>
<span class="s2">                    AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                    ORDER BY CycleIterations.FrameId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="c1"># TODO : check if empty</span>
            <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
            <span class="n">condition_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_conditionIds_per_cycle_per_frame because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">frame_ids</span><span class="p">,</span> <span class="n">condition_ids</span>

    <span class="k">def</span> <span class="nf">get_Names_from_AnnotationTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the names of all the available annotations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Name FROM AnnotationTypes&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_Name_from_AnnotationTypes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">names</span>

    <span class="k">def</span> <span class="nf">get_Structure_from_Cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns cycle Structure if the annotation has a cycle entry or None otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="p">,)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Structure FROM Cycles WHERE AnnotationTypeId = </span>
<span class="s2">                             (SELECT Id FROM AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
                <span class="n">cycle</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cycle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_Structure_from_Cycle because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cycle</span>

    <span class="k">def</span> <span class="nf">get_Name_and_Description_from_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Name and description for the labels that correspond to the annotation</span>
<span class="sd">        with the provided group name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="p">,)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">descriptions</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Name, Description FROM AnnotationTypeLabels WHERE AnnotationTypeId = </span>
<span class="s2">                             (SELECT Id FROM AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">descriptions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_Name_and_Description_from_AnnotationTypeLabels because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">names</span><span class="p">,</span> <span class="n">descriptions</span>

    <span class="k">def</span> <span class="nf">_get_Names_from_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Name FROM AnnotationTypeLabels ORDER BY Id ASC&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_Name_from_AnnotationTypeLabels because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">names</span>

    <span class="k">def</span> <span class="nf">get_Id_map_to_Names_from_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary with Ids as keys and names as values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Id, Name FROM AnnotationTypeLabels ORDER BY Id ASC&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
                <span class="n">mapping</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_Id_map_to_Names_from_AnnotationTypeLabels because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mapping</span>

    <span class="k">def</span> <span class="nf">_get_Id_from_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the AnnotationTypeLabels.Id for a label , searching by its name and group name.</span>
<span class="sd">        :param label_info: (group, name), where group is the AnnotationType.Name</span>
<span class="sd">                            and name is AnnotationTypeLabels.Name</span>
<span class="sd">        :type label_info: tuple</span>
<span class="sd">        :return: AnnotationLabels.Id</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Id FROM AnnotationTypeLabels </span>
<span class="s2">                    WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                    and Name = ?&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">label_info</span><span class="p">)</span>
            <span class="n">label_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">label_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Could not find a label from group </span><span class="si">{</span><span class="n">label_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span> \
                                         <span class="sa">f</span><span class="s2">&quot;with name </span><span class="si">{</span><span class="n">label_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">. &quot;</span> \
                                         <span class="sa">f</span><span class="s2">&quot;Are you sure it&#39;s been added into the database? &quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_AnnotationLabelId because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">label_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_Ids_from_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the AnnotationTypeLabels.Id for all labels , searching by their group name.</span>
<span class="sd">        :param group: AnnotationType.Name</span>
<span class="sd">        :type group: str</span>
<span class="sd">        :return: AnnotationLabels.Id</span>
<span class="sd">        :rtype: [(int,),(int,) ... ]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="p">,)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Id FROM AnnotationTypeLabels </span>
<span class="s2">                    WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
            <span class="n">label_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">label_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Could not find labels from group </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2"> &quot;</span> \
                                          <span class="s2">&quot;Are you sure it&#39;s been added into the database? &quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_AnnotationLabelIds because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">label_ids</span>

    <span class="k">def</span> <span class="nf">get_AnnotationTypeLabelId_from_Annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the AnnotationTypeLabelIds for all labels in the order according to the FrameId,</span>
<span class="sd">         searching by their group name.</span>
<span class="sd">        :param group: AnnotationType.Name</span>
<span class="sd">        :type group: str</span>
<span class="sd">        :return: AnnotationLabels.Id</span>
<span class="sd">        :rtype: [int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="p">,)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot; SELECT AnnotationTypeLabelId FROM Annotations WHERE AnnotationTypeLabelId IN</span>
<span class="s2">                            (SELECT Id FROM AnnotationTypeLabels </span>
<span class="s2">                            WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?))</span>
<span class="s2">                            ORDER BY FrameId ASC&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
            <span class="n">label_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
            <span class="k">assert</span> <span class="n">label_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Could not find labels from group </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2"> &quot;</span> \
                                          <span class="s2">&quot;Are you sure it&#39;s been added into the database? &quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_AnnotationTypeLabelId_from_Annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">label_ids</span>

    <span class="k">def</span> <span class="nf">_get_SliceInVolume_from_Volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Chooses the slices that correspond to the specified frames.</span>
<span class="sd">        The order of the frames is not preserved!</span>
<span class="sd">        the volume correspond to frames sorted in increasing order !</span>

<span class="sd">        :param frames: a list of frame IDs</span>
<span class="sd">        :type frames: [int]</span>
<span class="sd">        :return: volume IDs</span>
<span class="sd">        :rtype: [int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create list of frame Ids</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
        <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">)</span>

        <span class="c1"># get the volumes</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT SliceInVolume FROM Volumes </span>
<span class="s2">                    WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span><span class="p">)</span>
            <span class="n">slice_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_SliceInVolume_from_Volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">slice_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">slice_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">slice_id</span> <span class="ow">in</span> <span class="n">slice_ids</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">slice_ids</span>

    <span class="k">def</span> <span class="nf">_get_VolumeId_from_Volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Chooses the volumes that correspond to the specified frames.</span>
<span class="sd">        The order is not preserved!</span>
<span class="sd">        the volume correspond to sorted frames in increasing order !</span>

<span class="sd">        :param frames: a list of frame IDs</span>
<span class="sd">        :type frames: [int]</span>
<span class="sd">        :return: volume IDs</span>
<span class="sd">        :rtype: [int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create list of frame Ids</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
        <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">)</span>

        <span class="c1"># get the volumes</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># create a parameterised query with variable number of parameters</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT VolumeId FROM Volumes </span>
<span class="s2">                    WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span><span class="p">)</span>
            <span class="n">volume_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_VolumeId_from_Volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">volume_ids</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">volume_ids</span>

    <span class="k">def</span> <span class="nf">delete_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes annotation from all the tables.</span>
<span class="sd">        Deletion by &quot;ON DELETE CASCADE&quot; from AnnotationTypes, AnnotationTypeLabels, Annotations,</span>
<span class="sd">        Cycles, CycleIterations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,)</span>
        <span class="c1"># get the volumes</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;DELETE FROM AnnotationTypes </span>
<span class="s2">                            WHERE Name = ?&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not delete_annotation because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.choose_frames_per_slices" class="doc doc-heading">
<code class="highlight language-python"><span class="n">choose_frames_per_slices</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">slices</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Chooses the frames from specified frames, that also correspond to the same slices (continuously)
in different volumes.
For example, if slices = [2,3,4] it will choose such frames from "given frames" that also correspond
to a chunk from slice 2 to slice 4 in all the volumes.
If there is a frame that corresponds to a slice "2" in a volume,
but no frames corresponding to the slices "3" and "4" in the SAME volume, such frame will not be picked.</p>
<p>The order of the frames is not preserved!
The result will correspond to frames sorted in increasing order !</p>
<p>:param frames: a list of frame IDs
:type frames: [int]
:param slices: a list of slice IDs, order will not be preserved: will be sorted in increasing order
:type slices: [int]
:return: frames IDs from frames. corresponding to slices
:rtype: [int]</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">choose_frames_per_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">slices</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Chooses the frames from specified frames, that also correspond to the same slices (continuously)</span>
<span class="sd">    in different volumes.</span>
<span class="sd">    For example, if slices = [2,3,4] it will choose such frames from &quot;given frames&quot; that also correspond</span>
<span class="sd">    to a chunk from slice 2 to slice 4 in all the volumes.</span>
<span class="sd">    If there is a frame that corresponds to a slice &quot;2&quot; in a volume,</span>
<span class="sd">    but no frames corresponding to the slices &quot;3&quot; and &quot;4&quot; in the SAME volume, such frame will not be picked.</span>

<span class="sd">    The order of the frames is not preserved!</span>
<span class="sd">    The result will correspond to frames sorted in increasing order !</span>

<span class="sd">    :param frames: a list of frame IDs</span>
<span class="sd">    :type frames: [int]</span>
<span class="sd">    :param slices: a list of slice IDs, order will not be preserved: will be sorted in increasing order</span>
<span class="sd">    :type slices: [int]</span>
<span class="sd">    :return: frames IDs from frames. corresponding to slices</span>
<span class="sd">    :rtype: [int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create list of frame Ids</span>
    <span class="n">frame_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
    <span class="n">slice_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
    <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">)</span>
    <span class="n">n_slices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>

    <span class="c1"># get the volumes</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Volumes</span>
<span class="s2">                WHERE FrameId in (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                AND SliceInVolume IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_slices</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                AND VolumeId IN</span>
<span class="s2">                    (</span>
<span class="s2">                    SELECT VolumeId FROM</span>
<span class="s2">                        (</span>
<span class="s2">                        SELECT VolumeId, count(VolumeId) as N </span>
<span class="s2">                        FROM Volumes </span>
<span class="s2">                        WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                        AND SliceInVolume IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_slices</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                        GROUP BY VolumeId</span>
<span class="s2">                        )</span>
<span class="s2">                    WHERE N = ?</span>
<span class="s2">                    )&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="n">slice_ids</span> <span class="o">+</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="n">slice_ids</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_slices</span><span class="p">,)</span>
        <span class="p">)</span>

        <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not choose_frames_per_slices because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">frame_ids</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.choose_full_volumes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">choose_full_volumes</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Chooses the frames from specified frames, that also correspond to full volumes.</p>
<p>The order of the frames is not preserved!
The result will correspond to frames sorted in increasing order !</p>
<p>:param frames: a list of frame IDs
:type frames: [int]
:param fpv: frames per volume
:type fpv: int
:return: frames IDs from frames. corresponding to slices
:rtype: [int]</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">choose_full_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Chooses the frames from specified frames, that also correspond to full volumes.</span>

<span class="sd">    The order of the frames is not preserved!</span>
<span class="sd">    The result will correspond to frames sorted in increasing order !</span>

<span class="sd">    :param frames: a list of frame IDs</span>
<span class="sd">    :type frames: [int]</span>
<span class="sd">    :param fpv: frames per volume</span>
<span class="sd">    :type fpv: int</span>
<span class="sd">    :return: frames IDs from frames. corresponding to slices</span>
<span class="sd">    :rtype: [int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create list of frame Ids</span>
    <span class="n">frame_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
    <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_ids</span><span class="p">)</span>

    <span class="c1"># get the volumes</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># get n_volumes (frames per volume)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<span class="s2">                WHERE Key = &quot;frames_per_volume&quot; &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">fpv</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># get ids of full volumes in the provided frames</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT VolumeId FROM</span>
<span class="s2">                (</span>
<span class="s2">                SELECT VolumeId, count(VolumeId) as N</span>
<span class="s2">                FROM Volumes</span>
<span class="s2">                WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                GROUP BY VolumeId</span>
<span class="s2">                )</span>
<span class="s2">                WHERE N = ?&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="p">(</span><span class="n">fpv</span><span class="p">,)</span>
        <span class="p">)</span>
        <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
        <span class="n">n_volumes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">)</span>

        <span class="c1"># get all frames from frames that correspond to full volumes</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Volumes</span>
<span class="s2">                WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                AND VolumeId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_volumes</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">frame_ids</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not choose_full_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">volume_ids</span><span class="p">,</span> <span class="n">frame_ids</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.delete_annotation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">delete_annotation</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Deletes annotation from all the tables.
Deletion by "ON DELETE CASCADE" from AnnotationTypes, AnnotationTypeLabels, Annotations,
Cycles, CycleIterations.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes annotation from all the tables.</span>
<span class="sd">    Deletion by &quot;ON DELETE CASCADE&quot; from AnnotationTypes, AnnotationTypeLabels, Annotations,</span>
<span class="sd">    Cycles, CycleIterations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,)</span>
    <span class="c1"># get the volumes</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;DELETE FROM AnnotationTypes </span>
<span class="s2">                        WHERE Name = ?&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not delete_annotation because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_AnnotationTypeLabelId_from_Annotations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_AnnotationTypeLabelId_from_Annotations</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns the AnnotationTypeLabelIds for all labels in the order according to the FrameId,
 searching by their group name.
:param group: AnnotationType.Name
:type group: str
:return: AnnotationLabels.Id
:rtype: [int]</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_AnnotationTypeLabelId_from_Annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the AnnotationTypeLabelIds for all labels in the order according to the FrameId,</span>
<span class="sd">     searching by their group name.</span>
<span class="sd">    :param group: AnnotationType.Name</span>
<span class="sd">    :type group: str</span>
<span class="sd">    :return: AnnotationLabels.Id</span>
<span class="sd">    :rtype: [int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">group</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="p">,)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># create a parameterised query with variable number of parameters</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot; SELECT AnnotationTypeLabelId FROM Annotations WHERE AnnotationTypeLabelId IN</span>
<span class="s2">                        (SELECT Id FROM AnnotationTypeLabels </span>
<span class="s2">                        WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?))</span>
<span class="s2">                        ORDER BY FrameId ASC&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
        <span class="n">label_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
        <span class="k">assert</span> <span class="n">label_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Could not find labels from group </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2"> &quot;</span> \
                                      <span class="s2">&quot;Are you sure it&#39;s been added into the database? &quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_AnnotationTypeLabelId_from_Annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">label_ids</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_Id_map_to_Names_from_AnnotationTypeLabels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_Id_map_to_Names_from_AnnotationTypeLabels</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a dictionary with Ids as keys and names as values.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_Id_map_to_Names_from_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a dictionary with Ids as keys and names as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># create a parameterised query with variable number of parameters</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Id, Name FROM AnnotationTypeLabels ORDER BY Id ASC&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
            <span class="n">mapping</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_Id_map_to_Names_from_AnnotationTypeLabels because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">mapping</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_Name_and_Description_from_AnnotationTypeLabels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_Name_and_Description_from_AnnotationTypeLabels</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns the Name and description for the labels that correspond to the annotation
with the provided group name.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_Name_and_Description_from_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the Name and description for the labels that correspond to the annotation</span>
<span class="sd">    with the provided group name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">group</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="p">,)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">descriptions</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># create a parameterised query with variable number of parameters</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Name, Description FROM AnnotationTypeLabels WHERE AnnotationTypeId = </span>
<span class="s2">                         (SELECT Id FROM AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">descriptions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_Name_and_Description_from_AnnotationTypeLabels because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">names</span><span class="p">,</span> <span class="n">descriptions</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_Names_from_AnnotationTypes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_Names_from_AnnotationTypes</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns the names of all the available annotations.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_Names_from_AnnotationTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the names of all the available annotations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># create a parameterised query with variable number of parameters</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Name FROM AnnotationTypes&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_Name_from_AnnotationTypes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">names</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_Structure_from_Cycle" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_Structure_from_Cycle</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns cycle Structure if the annotation has a cycle entry or None otherwise.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_Structure_from_Cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns cycle Structure if the annotation has a cycle entry or None otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">group</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="p">,)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># create a parameterised query with variable number of parameters</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Structure FROM Cycles WHERE AnnotationTypeId = </span>
<span class="s2">                         (SELECT Id FROM AnnotationTypes WHERE Name = ?)&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
            <span class="n">cycle</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cycle</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_Structure_from_Cycle because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cycle</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_and_frames_per_annotations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_and_frames_per_annotations</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Chooses the frames that correspond to the specified conditions on annotation. Using "and" logic. Example : if
you ask for frames corresponding to condition 1 and condition 2 , it will return such frames that both
condition 1 and condition 2 are True AT THE SAME TIME</p>
<p>:param conditions: a list of conditions on the annotation labels
in a form [(group, name),(group, name), ...] where group is a string for the annotation type
and name is the name of the label of that annotation type. For example [('light', 'on'), ('shape','c')]
:type conditions: [tuple]
:return: list of frame Ids that satisfy all the conditions, if there are no such frames, an empty list
:rtype: list</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_and_frames_per_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Chooses the frames that correspond to the specified conditions on annotation. Using &quot;and&quot; logic. Example : if</span>
<span class="sd">    you ask for frames corresponding to condition 1 and condition 2 , it will return such frames that both</span>
<span class="sd">    condition 1 and condition 2 are True AT THE SAME TIME</span>

<span class="sd">    :param conditions: a list of conditions on the annotation labels</span>
<span class="sd">    in a form [(group, name),(group, name), ...] where group is a string for the annotation type</span>
<span class="sd">    and name is the name of the label of that annotation type. For example [(&#39;light&#39;, &#39;on&#39;), (&#39;shape&#39;,&#39;c&#39;)]</span>
<span class="sd">    :type conditions: [tuple]</span>
<span class="sd">    :return: list of frame Ids that satisfy all the conditions, if there are no such frames, an empty list</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create list of label Ids</span>
    <span class="n">labels_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">label_info</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
        <span class="n">labels_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_Id_from_AnnotationTypeLabels</span><span class="p">(</span><span class="n">label_info</span><span class="p">))</span>
    <span class="n">labels_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>
    <span class="n">n_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>

    <span class="c1"># get the frames</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># create a parameterised query with variable number of parameters</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM </span>
<span class="s2">                (SELECT FrameId, count(FrameId) as N </span>
<span class="s2">                FROM Annotations </span>
<span class="s2">                WHERE AnnotationTypeLabelId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_labels</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                GROUP BY FrameId)</span>
<span class="s2">                WHERE N = </span><span class="si">{</span><span class="n">n_labels</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">labels_ids</span><span class="p">)</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_and_FrameId_from_Annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># TODO : get rid of list of tuples?</span>
    <span class="c1">#  https://www.reddit.com/r/Python/comments/2iiqri/quick_question_why_are_sqlite_fields_returned_as/</span>
    <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">frame_ids</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_conditionIds_per_cycle_per_frame" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_conditionIds_per_cycle_per_frame</span><span class="p">(</span><span class="n">annotation_name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a list of condition IDs that correspond to each frame, list of corresponding frames.
annotation_name: str</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_conditionIds_per_cycle_per_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of condition IDs that correspond to each frame, list of corresponding frames.</span>
<span class="sd">    annotation_name: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO : check if empty</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># create a parameterised query with variable number of parameters</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT CycleIterations.FrameId, AnnotationTypeLabelId FROM</span>
<span class="s2">                CycleIterations </span>
<span class="s2">                INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<span class="s2">                WHERE AnnotationTypeLabelId in </span>
<span class="s2">                    (</span>
<span class="s2">                    SELECT Id from AnnotationTypeLabels </span>
<span class="s2">                    WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                    )</span>
<span class="s2">                AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                AND CycleIteration = 0</span>
<span class="s2">                ORDER BY CycleIterations.FrameId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1"># TODO : check if empty</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
        <span class="n">condition_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_conditionIds_per_cycle_per_frame because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">frame_ids</span><span class="p">,</span> <span class="n">condition_ids</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_conditionIds_per_cycle_per_volumes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_conditionIds_per_cycle_per_volumes</span><span class="p">(</span><span class="n">annotation_name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a list of condition IDs that correspond to each volume, list of corresponding volumes
and a count of the volume-condition pairs
annotation_name: str</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_conditionIds_per_cycle_per_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of condition IDs that correspond to each volume, list of corresponding volumes</span>
<span class="sd">    and a count of the volume-condition pairs</span>
<span class="sd">    annotation_name: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO : check if empty</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># create a parameterised query with variable number of parameters</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT VolumeId, AnnotationTypeLabelId, count(VolumeId) FROM</span>
<span class="s2">                CycleIterations </span>
<span class="s2">                INNER JOIN Volumes ON CycleIterations.FrameId = Volumes.FrameId </span>
<span class="s2">                INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<span class="s2">                WHERE AnnotationTypeLabelId in </span>
<span class="s2">                    (</span>
<span class="s2">                    SELECT Id from AnnotationTypeLabels </span>
<span class="s2">                    WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                    )</span>
<span class="s2">                AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                AND CycleIteration = 0</span>
<span class="s2">                GROUP BY VolumeId, AnnotationTypeLabelId</span>
<span class="s2">                ORDER BY VolumeId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1"># TODO : check if empty</span>
        <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
        <span class="n">condition_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_conditions_per_cycle_per_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">volume_ids</span><span class="p">,</span> <span class="n">condition_ids</span><span class="p">,</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_cycleIterations_per_frame" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_cycleIterations_per_frame</span><span class="p">(</span><span class="n">annotation_name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a list of cycle iterations that correspond to each frame, list of corresponding frames.
annotation_name: str</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_cycleIterations_per_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of cycle iterations that correspond to each frame, list of corresponding frames.</span>
<span class="sd">    annotation_name: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO : check if empty</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># create a parameterised query with variable number of parameters</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT CycleIterations.FrameId, CycleIteration FROM</span>
<span class="s2">                CycleIterations </span>
<span class="s2">                INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<span class="s2">                WHERE AnnotationTypeLabelId in </span>
<span class="s2">                    (</span>
<span class="s2">                    SELECT Id from AnnotationTypeLabels </span>
<span class="s2">                    WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                    )</span>
<span class="s2">                AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                ORDER BY CycleIterations.FrameId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1"># TODO : check if empty</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
        <span class="n">condition_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_conditionIds_per_cycle_per_frame because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">frame_ids</span><span class="p">,</span> <span class="n">condition_ids</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_cycleIterations_per_volumes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_cycleIterations_per_volumes</span><span class="p">(</span><span class="n">annotation_name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a list of cycleIterations that correspond to each volume, list of corresponding volumes
and a count of the volume-iteration pairs
annotation_name: str</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_cycleIterations_per_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of cycleIterations that correspond to each volume, list of corresponding volumes</span>
<span class="sd">    and a count of the volume-iteration pairs</span>
<span class="sd">    annotation_name: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO : check if empty</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># create a parameterised query with variable number of parameters</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT VolumeId, CycleIteration, count(VolumeId) FROM</span>
<span class="s2">                CycleIterations </span>
<span class="s2">                INNER JOIN Volumes ON CycleIterations.FrameId = Volumes.FrameId </span>
<span class="s2">                INNER JOIN Annotations ON CycleIterations.FrameId = Annotations.FrameId </span>
<span class="s2">                WHERE AnnotationTypeLabelId in </span>
<span class="s2">                    (</span>
<span class="s2">                    SELECT Id from AnnotationTypeLabels </span>
<span class="s2">                    WHERE AnnotationTypeId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                    )</span>
<span class="s2">                AND CycleId = (SELECT Id from AnnotationTypes WHERE Name = ?)</span>
<span class="s2">                GROUP BY VolumeId</span>
<span class="s2">                ORDER BY VolumeId&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation_name</span><span class="p">,</span> <span class="n">annotation_name</span><span class="p">))</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1"># TODO : check if empty</span>
        <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
        <span class="n">cycle_its</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_cycleIterations_per_volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">volume_ids</span><span class="p">,</span> <span class="n">cycle_its</span><span class="p">,</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_data_dir" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_data_dir</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get data directory</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_data_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get data directory</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<span class="s2">                 WHERE Key = &quot;data_dir&quot; &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">data_dir</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_data_dir because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">data_dir</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_fgf" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_fgf</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get frames per volume</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_fgf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get frames per volume</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<span class="s2">                 WHERE Key = &quot;num_head_frames&quot; &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">fdf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_fgf because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fdf</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_file_names" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_file_names</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get the file names from the Files table.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_file_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the file names from the Files table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FileName FROM Files ORDER BY Id ASC&quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_file_names because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">file_names</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_fpv" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_fpv</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get frames per volume</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_fpv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get frames per volume</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value FROM Options </span>
<span class="s2">                 WHERE Key = &quot;frames_per_volume&quot; &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">fpv</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_fpv because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fpv</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_frames_per_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_frames_per_file</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get the file names from the Files table.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_frames_per_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the file names from the Files table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT NumFrames FROM Files ORDER BY Id ASC&quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">frames_per_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_frames_per_file because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">frames_per_file</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_frames_per_volumes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_frames_per_volumes</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Finds all the frames that correspond to the specified volumes.
The order is not preserved!
the volume correspond to sorted volumes in increasing order !</p>
<p>:param volume_ids: a list of volume IDs
:type volume_ids: [int]
:return: frame IDs
:rtype: [int]</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_frames_per_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume_ids</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds all the frames that correspond to the specified volumes.</span>
<span class="sd">    The order is not preserved!</span>
<span class="sd">    the volume correspond to sorted volumes in increasing order !</span>

<span class="sd">    :param volume_ids: a list of volume IDs</span>
<span class="sd">    :type volume_ids: [int]</span>
<span class="sd">    :return: frame IDs</span>
<span class="sd">    :rtype: [int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">list_of_int</span><span class="p">(</span><span class="n">volume_ids</span><span class="p">)</span>

    <span class="c1"># get the frames</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># create a parameterised query with variable number of parameters</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Volumes </span>
<span class="s2">                WHERE VolumeId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_FrameId_from_Volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># TODO : get rid of list of tuples?</span>
    <span class="c1">#  https://www.reddit.com/r/Python/comments/2iiqri/quick_question_why_are_sqlite_fields_returned_as/</span>
    <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">frame_ids</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_options" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_options</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Gets the information from the OPTIONS table.
Returns a dictionary with the Key: Value from the table.
( Keys: 'data_dir', 'frames_per_volume', 'num_head_frames', 'num_tail_frames', 'num_full_volumes' )</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the information from the OPTIONS table.</span>
<span class="sd">    Returns a dictionary with the Key: Value from the table.</span>
<span class="sd">    ( Keys: &#39;data_dir&#39;, &#39;frames_per_volume&#39;, &#39;num_head_frames&#39;, &#39;num_tail_frames&#39;, &#39;num_full_volumes&#39; )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT * FROM Options&quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
            <span class="n">options</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get_options because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">options</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_or_frames_per_annotations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_or_frames_per_annotations</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Chooses the frames that correspond to the specified conditions on annotation. Using "or" logic. Example : if
you ask for frames corresponding to condition 1 and condition 2 , it will return such frames that either
condition 1 is true OR condition 2 is True OR both are true.</p>
<p>:param conditions: a list of conditions on the annotation labels
in a form [(group, name),(group, name), ...] where group is a string for the annotation type
and name is the name of the label of that annotation type. For example [('light', 'on'), ('shape','c')]
:type conditions: [tuple]
:return:
:rtype:</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_or_frames_per_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Chooses the frames that correspond to the specified conditions on annotation. Using &quot;or&quot; logic. Example : if</span>
<span class="sd">    you ask for frames corresponding to condition 1 and condition 2 , it will return such frames that either</span>
<span class="sd">    condition 1 is true OR condition 2 is True OR both are true.</span>

<span class="sd">    :param conditions: a list of conditions on the annotation labels</span>
<span class="sd">    in a form [(group, name),(group, name), ...] where group is a string for the annotation type</span>
<span class="sd">    and name is the name of the label of that annotation type. For example [(&#39;light&#39;, &#39;on&#39;), (&#39;shape&#39;,&#39;c&#39;)]</span>
<span class="sd">    :type conditions: [tuple]</span>
<span class="sd">    :return:</span>
<span class="sd">    :rtype:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create list of label Ids</span>
    <span class="n">labels_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">label_info</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
        <span class="n">labels_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_Id_from_AnnotationTypeLabels</span><span class="p">(</span><span class="n">label_info</span><span class="p">))</span>
    <span class="n">labels_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>
    <span class="n">n_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_ids</span><span class="p">)</span>

    <span class="c1"># get the frames</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># create a parameterised query with variable number of parameters</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FrameId FROM Annotations </span>
<span class="s2">                WHERE AnnotationTypeLabelId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_labels</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">                GROUP BY FrameId&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">labels_ids</span><span class="p">)</span>
        <span class="n">frame_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not _get_or_FrameId_from_Annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># TODO : get rid of list of tuples?</span>
    <span class="c1">#  https://www.reddit.com/r/Python/comments/2iiqri/quick_question_why_are_sqlite_fields_returned_as/</span>
    <span class="n">frame_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frame_ids</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">frame_ids</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.get_volume_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_volume_list</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a list of all the volumes.
:return: list of all the volumes
:rtype: [int]</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_volume_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of all the volumes.</span>
<span class="sd">    :return: list of all the volumes</span>
<span class="sd">    :rtype: [int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT DISTINCT VolumeId FROM Volumes&quot;</span><span class="p">)</span>
        <span class="n">volume_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get total number of frames from Frames because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">volume_ids</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.load" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Load the contents of a database file on disk to a
transient copy in memory without modifying the file</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the contents of a database file on disk to a</span>
<span class="sd">    transient copy in memory without modifying the file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">disk_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">memory_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
    <span class="n">disk_db</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
    <span class="n">disk_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># Now use `memory_db` without modifying disk db</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbReader.prepare_frames_for_loading" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_frames_for_loading</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Finds all the information needed
1) to load the frames
2) and shape them back into volumes/slices.
For each frame returns the image file,
frame location on the image and corresponding volume.</p>
<p>The order is not preserved!
the volume correspond to sorted volumes in increasing order !</p>
<p>:param frames: a list of frame IDs
:type frames: [int]
:return: three lists, the length of the frames :
        data directory, file names,
        image files, frame location on the image, volumes.
:rtype: str, [str], [str],[int],[int]</p>
<h4 id="src.vodex.dbmethods.DbReader.prepare_frames_for_loading--todo-break-into-functions-that-get-the-file-locations-and-the-stuff-relevant-to-the-frames">TODO : break into functions that get the file locations and the stuff relevant to the frames</h4>
<h4 id="src.vodex.dbmethods.DbReader.prepare_frames_for_loading--todo-make-one-prepare-volumes-for-loading">TODO : make one " prepare volumes " for loading?</h4>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">prepare_frames_for_loading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds all the information needed</span>
<span class="sd">    1) to load the frames</span>
<span class="sd">    2) and shape them back into volumes/slices.</span>
<span class="sd">    For each frame returns the image file,</span>
<span class="sd">    frame location on the image and corresponding volume.</span>

<span class="sd">    The order is not preserved!</span>
<span class="sd">    the volume correspond to sorted volumes in increasing order !</span>

<span class="sd">    :param frames: a list of frame IDs</span>
<span class="sd">    :type frames: [int]</span>
<span class="sd">    :return: three lists, the length of the frames :</span>
<span class="sd">            data directory, file names,</span>
<span class="sd">            image files, frame location on the image, volumes.</span>
<span class="sd">    :rtype: str, [str], [str],[int],[int]</span>
<span class="sd">    # TODO : break into functions that get the file locations and the stuff relevant to the frames</span>
<span class="sd">    # TODO : make one &quot; prepare volumes &quot; for loading?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>

    <span class="c1"># get the frames</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># get data directory</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT Value</span>
<span class="s2">                FROM Options</span>
<span class="s2">                WHERE Key = &quot;data_dir&quot; &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">data_dir</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># get file_names</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT FileName</span>
<span class="s2">                FROM Files &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">file_names</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

        <span class="c1"># get info for every frame</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT </span>
<span class="s2">                    FileId,</span>
<span class="s2">                    FrameInFile,</span>
<span class="s2">                    VolumeId</span>
<span class="s2">                FROM </span>
<span class="s2">                    Frames</span>
<span class="s2">                    INNER JOIN Volumes </span>
<span class="s2">                    ON Frames.Id = Volumes.FrameId</span>
<span class="s2">                WHERE FrameId IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">frames</span><span class="p">))</span>
        <span class="n">frame_info</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not prepare_frames_for_loading because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">]</span>

    <span class="n">file_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">frame_info</span><span class="p">]</span>
    <span class="n">frame_in_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">frame_info</span><span class="p">]</span>
    <span class="n">volumes</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">frame_info</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">data_dir</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">file_ids</span><span class="p">,</span> <span class="n">frame_in_file</span><span class="p">,</span> <span class="n">volumes</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.vodex.dbmethods.DbWriter" class="doc doc-heading">
        <code>DbWriter</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Writes information to the database.
Database interface that abstracts the SQLite calls.</p>

<details class="learning-resources">
  <summary>Learning resources</summary>
  <p>sql:
https://www.devdungeon.com/content/python-sqlite3-tutorial
https://www.sqlitetutorial.net/sqlite-python/creating-tables/
try-catch :
https://softwareengineering.stackexchange.com/questions/64180/good-use-of-try-catch-blocks</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>connection</code></td>
          <td>
          </td>
          <td><p>connection to the SQL database</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DbWriter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes information to the database.</span>
<span class="sd">    Database interface that abstracts the SQLite calls.</span>

<span class="sd">    Learning resources:</span>
<span class="sd">        sql:</span>
<span class="sd">        https://www.devdungeon.com/content/python-sqlite3-tutorial</span>
<span class="sd">        https://www.sqlitetutorial.net/sqlite-python/creating-tables/</span>
<span class="sd">        try-catch :</span>
<span class="sd">        https://softwareengineering.stackexchange.com/questions/64180/good-use-of-try-catch-blocks</span>

<span class="sd">    Args:</span>
<span class="sd">        connection: connection to the SQL database</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA foreign_keys = 1&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Backup a database to a file.</span>
<span class="sd">        Will CLOSE connection to the database in memory!</span>
<span class="sd">        Args:</span>
<span class="sd">            file_name : the name of the file to save database to, EX.: &#39;databasename.db&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">progress</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">remaining</span><span class="p">,</span> <span class="n">total</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Copied </span><span class="si">{</span><span class="n">total</span> <span class="o">-</span> <span class="n">remaining</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s1"> pages...&#39;</span><span class="p">)</span>

        <span class="n">backup_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">backup_db</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">backup_db</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span>
        <span class="c1"># self.connection.close()</span>
        <span class="n">backup_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an empty DB for the experiment in memory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO : figure out how to type-annotate classmethod</span>
        <span class="c1"># For an in-memory only database:</span>
        <span class="n">memory_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the contents of a database file on disk to a</span>
<span class="sd">        transient copy in memory without modifying the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">disk_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">memory_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
        <span class="n">disk_db</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
        <span class="n">disk_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># Now use `memory_db` without modifying disk db</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volumes</span><span class="p">:</span> <span class="n">VolumeManager</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">annotations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Annotation</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the tables if they don&#39;t exist and fills with the provided data.</span>
<span class="sd">        Args:</span>
<span class="sd">            volumes: mapping of frames to volumes, and to slices in volumes, frames per volume</span>
<span class="sd">            annotations: mapping of frames to labels, list of annotations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO : add warnings when you are trying to write the same data again</span>
        <span class="c1"># TODO : How to type annotate vodex classes from core ?</span>

        <span class="c1"># will only create if they don&#39;t exist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_tables</span><span class="p">()</span>
        <span class="c1"># TODO : write cases for files and frames not None</span>

        <span class="k">if</span> <span class="n">volumes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Options</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">file_manager</span><span class="p">,</span> <span class="n">volumes</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Files</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">file_manager</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Frames</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">frame_manager</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Volumes</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">annotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_annotations</span><span class="p">(</span><span class="n">annotations</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Annotation</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a list of annotations to the database.</span>
<span class="sd">        Does NOT save the database after adding.</span>
<span class="sd">        To keep this change in the future, you need to save the database after adding.</span>
<span class="sd">        Args:</span>
<span class="sd">            annotations: mapping of frames to labels, list of annotations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO : add list checking</span>
        <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_AnnotationTypes</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_AnnotationTypeLabels</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Annotations</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">annotation</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Cycles</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_populate_CycleIterations</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_n_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Queries and returns the total number of frames in the experiment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT COUNT(*) FROM Frames&quot;</span><span class="p">)</span>
            <span class="n">n_frames</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get total number of frames from Frames because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">n_frames</span>

    <span class="k">def</span> <span class="nf">_create_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># TODO : change UNIQUE(a, b)</span>
        <span class="c1"># into primary key over both columns a and b where appropriate</span>

        <span class="n">db_cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="n">sql_create_Options_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            CREATE TABLE IF NOT EXISTS &quot;Options&quot; (</span>
<span class="s2">            &quot;Key&quot;	TEXT NOT NULL UNIQUE,</span>
<span class="s2">            &quot;Value&quot;	TEXT NOT NULL,</span>
<span class="s2">            &quot;Description&quot;	TEXT,</span>
<span class="s2">            PRIMARY KEY(&quot;Key&quot;)</span>
<span class="s2">            )</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_Options_table</span><span class="p">)</span>

        <span class="n">sql_create_Files_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            CREATE TABLE IF NOT EXISTS &quot;Files&quot; (</span>
<span class="s2">            &quot;Id&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">            &quot;FileName&quot;	TEXT NOT NULL UNIQUE,</span>
<span class="s2">            &quot;NumFrames&quot;	INTEGER NOT NULL,</span>
<span class="s2">            PRIMARY KEY(&quot;Id&quot; AUTOINCREMENT)</span>
<span class="s2">            )</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_Files_table</span><span class="p">)</span>

        <span class="n">sql_create_AnnotationTypes_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            CREATE TABLE IF NOT EXISTS &quot;AnnotationTypes&quot; (</span>
<span class="s2">            &quot;Id&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">            &quot;Name&quot;	TEXT NOT NULL UNIQUE,</span>
<span class="s2">            &quot;Description&quot;	TEXT,</span>
<span class="s2">            PRIMARY KEY(&quot;Id&quot; AUTOINCREMENT)</span>
<span class="s2">            )</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_AnnotationTypes_table</span><span class="p">)</span>

        <span class="n">sql_create_Frames_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            CREATE TABLE IF NOT EXISTS &quot;Frames&quot; (</span>
<span class="s2">            &quot;Id&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">            &quot;FrameInFile&quot;	INTEGER NOT NULL,</span>
<span class="s2">            &quot;FileId&quot;	INTEGER NOT NULL,</span>
<span class="s2">            PRIMARY KEY(&quot;Id&quot; AUTOINCREMENT),</span>
<span class="s2">            FOREIGN KEY(&quot;FileId&quot;) REFERENCES &quot;Files&quot;(&quot;Id&quot;)</span>
<span class="s2">            )</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_Frames_table</span><span class="p">)</span>

        <span class="n">sql_create_Cycles_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            CREATE TABLE IF NOT EXISTS &quot;Cycles&quot; (</span>
<span class="s2">            &quot;Id&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">            &quot;AnnotationTypeId&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">            &quot;Structure&quot;	TEXT NOT NULL,</span>
<span class="s2">            FOREIGN KEY(&quot;AnnotationTypeId&quot;) REFERENCES &quot;AnnotationTypes&quot;(&quot;Id&quot;) ON DELETE CASCADE,</span>
<span class="s2">            PRIMARY KEY(&quot;Id&quot; AUTOINCREMENT)</span>
<span class="s2">            )</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_Cycles_table</span><span class="p">)</span>

        <span class="n">sql_create_AnnotationTypeLabels_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            CREATE TABLE IF NOT EXISTS &quot;AnnotationTypeLabels&quot; (</span>
<span class="s2">            &quot;Id&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">            &quot;AnnotationTypeId&quot;	INTEGER NOT NULL,</span>
<span class="s2">            &quot;Name&quot;	TEXT NOT NULL,</span>
<span class="s2">            &quot;Description&quot;	TEXT,</span>
<span class="s2">            PRIMARY KEY(&quot;Id&quot; AUTOINCREMENT),</span>
<span class="s2">            FOREIGN KEY(&quot;AnnotationTypeId&quot;) REFERENCES &quot;AnnotationTypes&quot;(&quot;Id&quot;) ON DELETE CASCADE,</span>
<span class="s2">            UNIQUE(&quot;AnnotationTypeId&quot;,&quot;Name&quot;)</span>
<span class="s2">            )</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_AnnotationTypeLabels_table</span><span class="p">)</span>

        <span class="n">sql_create_Annotations_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            CREATE TABLE IF NOT EXISTS &quot;Annotations&quot; (</span>
<span class="s2">            &quot;FrameId&quot;	INTEGER NOT NULL,</span>
<span class="s2">            &quot;AnnotationTypeLabelId&quot;	INTEGER NOT NULL,</span>
<span class="s2">            FOREIGN KEY(&quot;FrameId&quot;) REFERENCES &quot;Frames&quot;(&quot;Id&quot;),</span>
<span class="s2">            FOREIGN KEY(&quot;AnnotationTypeLabelId&quot;) REFERENCES &quot;AnnotationTypeLabels&quot;(&quot;Id&quot;) ON DELETE CASCADE,</span>
<span class="s2">            UNIQUE(&quot;FrameId&quot;,&quot;AnnotationTypeLabelId&quot;)</span>
<span class="s2">            )</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_Annotations_table</span><span class="p">)</span>

        <span class="n">sql_create_CycleIterations_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            CREATE TABLE IF NOT EXISTS &quot;CycleIterations&quot; (</span>
<span class="s2">            &quot;FrameId&quot;	INTEGER NOT NULL,</span>
<span class="s2">            &quot;CycleId&quot;	INTEGER NOT NULL,</span>
<span class="s2">            &quot;CycleIteration&quot;	INTEGER NOT NULL,</span>
<span class="s2">            FOREIGN KEY(&quot;CycleId&quot;) REFERENCES &quot;Cycles&quot;(&quot;Id&quot;) ON DELETE CASCADE,</span>
<span class="s2">            FOREIGN KEY(&quot;FrameId&quot;) REFERENCES &quot;Frames&quot;(&quot;Id&quot;)</span>
<span class="s2">            )</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_CycleIterations_table</span><span class="p">)</span>

        <span class="n">sql_create_Volumes_table</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            CREATE TABLE IF NOT EXISTS &quot;Volumes&quot; (</span>
<span class="s2">            &quot;FrameId&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">            &quot;VolumeId&quot;	INTEGER NOT NULL,</span>
<span class="s2">            &quot;SliceInVolume&quot;	INTEGER NOT NULL,</span>
<span class="s2">            PRIMARY KEY(&quot;FrameId&quot; AUTOINCREMENT),</span>
<span class="s2">            FOREIGN KEY(&quot;FrameId&quot;) REFERENCES &quot;Frames&quot;(&quot;Id&quot;)</span>
<span class="s2">            UNIQUE(&quot;VolumeId&quot;,&quot;SliceInVolume&quot;)</span>
<span class="s2">            )</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">db_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create_Volumes_table</span><span class="p">)</span>

        <span class="n">db_cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_populate_Options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_manager</span><span class="p">:</span> <span class="n">FileManager</span><span class="p">,</span> <span class="n">volume_manager</span><span class="p">:</span> <span class="n">VolumeManager</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the Options table (a dictionary with key - value pairs).</span>
<span class="sd">        Learning resources:</span>
<span class="sd">            another way of dealing with Errors : ( more pretty ??? )</span>
<span class="sd">            https://www.w3resource.com/python-exercises/sqlite/python-sqlite-exercise-6.php</span>
<span class="sd">        Args:</span>
<span class="sd">            file_manager: FileManager object that provides the data to populate the tables.</span>
<span class="sd">            volume_manager: VolumeManager object that provides the data to populate the tables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;data_dir&quot;</span><span class="p">,</span> <span class="n">file_manager</span><span class="o">.</span><span class="n">data_dir</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()),</span>
                    <span class="p">(</span><span class="s2">&quot;frames_per_volume&quot;</span><span class="p">,</span> <span class="n">volume_manager</span><span class="o">.</span><span class="n">fpv</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;num_head_frames&quot;</span><span class="p">,</span> <span class="n">volume_manager</span><span class="o">.</span><span class="n">n_head</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;num_tail_frames&quot;</span><span class="p">,</span> <span class="n">volume_manager</span><span class="o">.</span><span class="n">n_tail</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;num_full_volumes&quot;</span><span class="p">,</span> <span class="n">volume_manager</span><span class="o">.</span><span class="n">full_volumes</span><span class="p">)]</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO Options (Key, Value) VALUES (?, ?)&quot;</span><span class="p">,</span>
                <span class="n">row_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to Options because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_populate_Files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_manager</span><span class="p">:</span> <span class="n">FileManager</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the Files table with</span>
<span class="sd">        file_name : list with filenames per file (str), and</span>
<span class="sd">        num_frames : list with number of frames per file (int)</span>
<span class="sd">        Args:</span>
<span class="sd">            file_manager: FileManager object that provides the data to populate the tables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">filename</span><span class="p">,</span> <span class="n">frames</span><span class="p">)</span> <span class="k">for</span>
                    <span class="n">filename</span><span class="p">,</span> <span class="n">frames</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">file_manager</span><span class="o">.</span><span class="n">file_names</span><span class="p">,</span> <span class="n">file_manager</span><span class="o">.</span><span class="n">num_frames</span><span class="p">)]</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO Files (FileName, NumFrames) VALUES (?, ?)&quot;</span><span class="p">,</span>
                <span class="n">row_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to Files because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_populate_Frames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_manager</span><span class="p">:</span> <span class="n">FrameManager</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the Frames table with</span>
<span class="sd">        frame_in_file and frame_to_file mapping.</span>

<span class="sd">        Learning Resourses:</span>
<span class="sd">            Something like</span>
<span class="sd">            insert into tab2 (id_customers, value)</span>
<span class="sd">            values ((select id from tab1 where customers=&#39;john&#39;), &#39;alfa&#39;);</span>
<span class="sd">            but in SQLite</span>
<span class="sd">            https://www.tutorialspoint.com/sqlite/sqlite_insert_query.htm</span>

<span class="sd">        Args:</span>
<span class="sd">            frame_manager: FrameManager object that provides the data to populate the tables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># adding +1 since the frame_to_file is indexing files from 0 and sqlite gave files IDs from 1</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">frame_in_file</span><span class="p">,</span> <span class="n">frame_to_file</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span>
                    <span class="n">frame_in_file</span><span class="p">,</span> <span class="n">frame_to_file</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">frame_manager</span><span class="o">.</span><span class="n">frame_in_file</span><span class="p">,</span> <span class="n">frame_manager</span><span class="o">.</span><span class="n">frame_to_file</span><span class="p">)]</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO Frames (FrameInFile, FileId) VALUES (?, ?)&quot;</span><span class="p">,</span>
                <span class="n">row_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to Frames because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_populate_Volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume_manager</span><span class="p">:</span> <span class="n">VolumeManager</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the Volumes table with</span>
<span class="sd">        volume_id and slice_in_volume mapping.</span>

<span class="sd">        Args:</span>
<span class="sd">            volume_manager: VolumeManager object that provides the data to populate the tables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">volume_id</span><span class="p">,</span> <span class="n">slice_in_volume</span><span class="p">)</span> <span class="k">for</span>
                    <span class="n">volume_id</span><span class="p">,</span> <span class="n">slice_in_volume</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">volume_manager</span><span class="o">.</span><span class="n">frame_to_vol</span><span class="p">,</span> <span class="n">volume_manager</span><span class="o">.</span><span class="n">frame_to_z</span><span class="p">)]</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO Volumes (VolumeId, SliceInVolume) VALUES (?, ?)&quot;</span><span class="p">,</span>
                <span class="n">row_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to Volumes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_populate_AnnotationTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation</span><span class="p">:</span> <span class="n">Annotation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the AnnotationTypes table with</span>
<span class="sd">        annotation.name, annotation.info mapping.</span>

<span class="sd">        Args:</span>
<span class="sd">            volume_manager: VolumeManager object that provides the data to populate the tables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">annotation</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO AnnotationTypes (Name, Description) VALUES (?, ?)&quot;</span><span class="p">,</span>
                <span class="n">row_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to AnnotationTypes because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_populate_AnnotationTypeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation</span><span class="p">):</span>

        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">label</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">annotation</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">states</span><span class="p">]</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO AnnotationTypeLabels (AnnotationTypeId, Name, Description) &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;VALUES((SELECT Id FROM AnnotationTypes WHERE Name = ?), ?, ?)&quot;</span><span class="p">,</span>
                <span class="n">row_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to AnnotationTypeLabels because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_populate_Annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation</span><span class="p">):</span>
        <span class="n">n_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_n_frames</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">n_frames</span> <span class="o">==</span> <span class="n">annotation</span><span class="o">.</span><span class="n">n_frames</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Number of frames in the annotation, </span><span class="si">{</span><span class="n">annotation</span><span class="o">.</span><span class="n">n_frames</span><span class="si">}</span><span class="s2">,&quot;</span> \
                                                <span class="sa">f</span><span class="s2">&quot;doesn&#39;t match&quot;</span> \
                                                <span class="sa">f</span><span class="s2">&quot; the expected number of frames </span><span class="si">{</span><span class="n">n_frames</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">group</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">frame</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">annotation</span><span class="o">.</span><span class="n">frame_to_label</span><span class="p">)]</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO Annotations (FrameId, AnnotationTypeLabelId) &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;VALUES(?, (SELECT Id FROM AnnotationTypeLabels &quot;</span>
                <span class="s2">&quot;WHERE Name = ? &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;AND AnnotationTypeId = (SELECT Id FROM AnnotationTypes &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;WHERE Name = ?)))&quot;</span><span class="p">,</span>
                <span class="n">row_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write group </span><span class="si">{</span><span class="n">annotation</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> to Annotations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_populate_Cycles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">annotation</span><span class="o">.</span><span class="n">cycle</span><span class="o">.</span><span class="n">to_json</span><span class="p">())</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO Cycles (AnnotationTypeId, Structure) &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;VALUES((SELECT Id FROM AnnotationTypes WHERE Name = ?), ?)&quot;</span><span class="p">,</span>
                <span class="n">row_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to Cycles because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_populate_CycleIterations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation</span><span class="p">):</span>
        <span class="n">n_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_n_frames</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">n_frames</span> <span class="o">==</span> <span class="n">annotation</span><span class="o">.</span><span class="n">n_frames</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Number of frames in the annotation, </span><span class="si">{</span><span class="n">annotation</span><span class="o">.</span><span class="n">n_frames</span><span class="si">}</span><span class="s2">,&quot;</span> \
                                                <span class="sa">f</span><span class="s2">&quot;doesn&#39;t match&quot;</span> \
                                                <span class="sa">f</span><span class="s2">&quot; the expected number of frames </span><span class="si">{</span><span class="n">n_frames</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># get cycle id by annotation type</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT Id FROM Cycles &quot;</span> <span class="o">+</span>
            <span class="s2">&quot;WHERE AnnotationTypeId = (SELECT Id FROM AnnotationTypes &quot;</span> <span class="o">+</span>
            <span class="s2">&quot;WHERE Name = ?)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">name</span><span class="p">,))</span>
        <span class="n">cycle_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># prepare rows</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cycle_id</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">frame</span><span class="p">,</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">annotation</span><span class="o">.</span><span class="n">frame_to_cycle</span><span class="p">)]</span>

        <span class="c1"># insert into CycleIterations</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO CycleIterations (FrameId, CycleId, CycleIteration) &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;VALUES(?, ?,?)&quot;</span><span class="p">,</span> <span class="n">row_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write group </span><span class="si">{</span><span class="n">annotation</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> to CycleIterations because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbWriter.add_annotations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_annotations</span><span class="p">(</span><span class="n">annotations</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Adds a list of annotations to the database.
Does NOT save the database after adding.
To keep this change in the future, you need to save the database after adding.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>annotations</code></td>
          <td>
                <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="src.vodex.core.Annotation" href="../core/#src.vodex.core.Annotation">Annotation</a>]</code>
          </td>
          <td><p>mapping of frames to labels, list of annotations</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Annotation</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a list of annotations to the database.</span>
<span class="sd">    Does NOT save the database after adding.</span>
<span class="sd">    To keep this change in the future, you need to save the database after adding.</span>
<span class="sd">    Args:</span>
<span class="sd">        annotations: mapping of frames to labels, list of annotations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO : add list checking</span>
    <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_AnnotationTypes</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_AnnotationTypeLabels</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Annotations</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">annotation</span><span class="o">.</span><span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Cycles</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_CycleIterations</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbWriter.create" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates an empty DB for the experiment in memory.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an empty DB for the experiment in memory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO : figure out how to type-annotate classmethod</span>
    <span class="c1"># For an in-memory only database:</span>
    <span class="n">memory_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbWriter.get_n_frames" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_n_frames</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Queries and returns the total number of frames in the experiment.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_n_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Queries and returns the total number of frames in the experiment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT COUNT(*) FROM Frames&quot;</span><span class="p">)</span>
        <span class="n">n_frames</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get total number of frames from Frames because </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">n_frames</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbWriter.load" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Load the contents of a database file on disk to a
transient copy in memory without modifying the file.</p>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the contents of a database file on disk to a</span>
<span class="sd">    transient copy in memory without modifying the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">disk_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">memory_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
    <span class="n">disk_db</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
    <span class="n">disk_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># Now use `memory_db` without modifying disk db</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">memory_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbWriter.populate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">populate</span><span class="p">(</span><span class="n">volumes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">annotations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates the tables if they don't exist and fills with the provided data.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>volumes</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="src.vodex.core.VolumeManager" href="../core/#src.vodex.core.VolumeManager">VolumeManager</a></code>
          </td>
          <td><p>mapping of frames to volumes, and to slices in volumes, frames per volume</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>annotations</code></td>
          <td>
                <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="src.vodex.core.Annotation" href="../core/#src.vodex.core.Annotation">Annotation</a>]</code>
          </td>
          <td><p>mapping of frames to labels, list of annotations</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volumes</span><span class="p">:</span> <span class="n">VolumeManager</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">annotations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Annotation</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates the tables if they don&#39;t exist and fills with the provided data.</span>
<span class="sd">    Args:</span>
<span class="sd">        volumes: mapping of frames to volumes, and to slices in volumes, frames per volume</span>
<span class="sd">        annotations: mapping of frames to labels, list of annotations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO : add warnings when you are trying to write the same data again</span>
    <span class="c1"># TODO : How to type annotate vodex classes from core ?</span>

    <span class="c1"># will only create if they don&#39;t exist</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_tables</span><span class="p">()</span>
    <span class="c1"># TODO : write cases for files and frames not None</span>

    <span class="k">if</span> <span class="n">volumes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Options</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">file_manager</span><span class="p">,</span> <span class="n">volumes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Files</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">file_manager</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Frames</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">frame_manager</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_Volumes</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">annotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_annotations</span><span class="p">(</span><span class="n">annotations</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.vodex.dbmethods.DbWriter.save" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Backup a database to a file.
Will CLOSE connection to the database in memory!</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>file_name</code></td>
          <td>
          </td>
          <td><p>the name of the file to save database to, EX.: 'databasename.db'</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src\vodex\dbmethods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Backup a database to a file.</span>
<span class="sd">    Will CLOSE connection to the database in memory!</span>
<span class="sd">    Args:</span>
<span class="sd">        file_name : the name of the file to save database to, EX.: &#39;databasename.db&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">progress</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">remaining</span><span class="p">,</span> <span class="n">total</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Copied </span><span class="si">{</span><span class="n">total</span> <span class="o">-</span> <span class="n">remaining</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s1"> pages...&#39;</span><span class="p">)</span>

    <span class="n">backup_db</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">backup_db</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">backup_db</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span>
    <span class="c1"># self.connection.close()</span>
    <span class="n">backup_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>

        <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
